{"version":3,"sources":["starManagerView.es6.js"],"names":[],"mappings":"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","file":"starManagerView.js","sourcesContent":["/**\n * A manager for star buttons, for both datagrids and individual buttons.\n *\n * This view manages the state of review request and review group star status\n * in datagrids, as well as the star status for review requests on their\n * individual pages.\n */\nRB.StarManagerView = Backbone.View.extend({\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object, optional):\n     *         View initialization options.\n     *\n     * Option Args:\n     *     datagridMode (boolean):\n     *         Whether or not the manager is managing a datagrid.\n     */\n    initialize(options={}) {\n        const objects = this.model.get('objects');\n        const starred = this.model.get('starred');\n\n        this._datagridMode = options.datagridMode;\n\n        /*\n         * This doesn't use the view's events object to bind to _toggleStar\n         * because doing so interferes with event bubbling and handler order.\n         * We need the datagrid's click handler to run after this one, so we\n         * bind directly to the element rather than on the parent view.\n         */\n        this.$('div.star')\n            .on('click', this._toggleStar.bind(this))\n            .each((idx, el) => {\n            const $el = $(el);\n            const objType = $el.attr('data-object-type');\n            const objID = $el.attr('data-object-id');\n            const objStarred = (parseInt($el.attr('data-starred'), 10) === 1);\n            let obj;\n\n            if (objType === 'reviewrequests') {\n                obj = new RB.ReviewRequest({ id: objID });\n            } else if (objType === 'groups') {\n                obj = new RB.ReviewGroup({ id: objID });\n            } else if (objType !== undefined) {\n                console.assert('Unknown star object type: %s', objType);\n            } else {\n                /* Skip any stars that don't have an object type. */\n                return;\n            }\n\n            objects[objID] = obj;\n            starred[objID] = objStarred;\n        });\n\n        /*\n         * When the datagrid is in mobile mode, we have to keep track of any\n         * objects whose star status changes so that we can update the datagrid\n         * if it switches back to desktop mode.\n         */\n        this._watchUpdates = false;\n        this._toUpdate = {};\n\n        if (this._datagridMode) {\n            this.$el.on('datagridDisplayModeChanged', ($grid, options) => {\n                if (options.mode === 'desktop') {\n                    for (let objID in this._toUpdate) {\n                        if (this._toUpdate.hasOwnProperty(objID)) {\n                            this._updateStarColumn(objID);\n                        }\n                    }\n\n                    this._watchUpdates = false;\n                    this._toUpdate = {};\n                } else if (options.mode === 'mobile') {\n                    this._watchUpdates = true;\n                }\n            });\n\n            if (this.$el.attr('data-datagrid-display-mode') === 'mobile') {\n                this._watchUpdates = true;\n            }\n        }\n    },\n\n    /**\n     * Update a star column.\n     *\n     * This function is called when the datagrid changes from mobile to desktop\n     * model. Since datagrids copy the original DOM over the new one when the\n     * mode is changed to desktop, we must copy over relevant star attributes\n     * and classes when this happens.\n     *\n     * Args:\n     *     objID (string):\n     *         The object's unique ID, as a string.\n     */\n    _updateStarColumn(objID) {\n        const $el = this.$(`.star[data-object-id=\"${objID}\"]`);\n        const starred = this.model.get('starred')[objID];\n\n        $el\n            .toggleClass('rb-icon-star-on', starred)\n            .toggleClass('rb-icon-star-off', !starred)\n            .attr('title',\n                  starred ? gettext('Starred')\n                          : gettext('Click to star'));\n    },\n\n    /**\n     * Toggle an object being starred or unstarred.\n     *\n     * This function is called when a star icon is clicked.\n     *\n     * Args:\n     *     e (Event):\n     *         The click event.\n     */\n    _toggleStar(e) {\n        const $target = $(e.target);\n        const objID = $target.attr('data-object-id');\n        const obj = this.model.get('objects')[objID];\n        const starred = this.model.get('starred');\n        const objStarred = !starred[objID];\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (RB.UserSession.instance.get('readOnly')) {\n            return;\n        }\n\n        obj.setStarred(objStarred);\n        starred[objID] = objStarred;\n\n        if (this._watchUpdates) {\n            if (this._toUpdate.hasOwnProperty(objID)) {\n                delete this._toUpdate[objID];\n            } else {\n                this._toUpdate[objID] = true;\n            }\n        }\n\n        $target\n            .toggleClass('rb-icon-star-on', objStarred)\n            .toggleClass('rb-icon-star-off', !objStarred)\n            .attr('title',\n                  objStarred ? gettext('Starred')\n                             : gettext('Click to star'));\n    },\n});\n"]}