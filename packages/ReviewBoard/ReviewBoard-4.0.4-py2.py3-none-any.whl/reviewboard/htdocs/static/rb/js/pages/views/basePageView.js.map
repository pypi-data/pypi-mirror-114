{"version":3,"sources":["basePageView.es6.js"],"names":[],"mappings":"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","file":"basePageView.js","sourcesContent":["/**\n * Base class for the views for pages.\n *\n * This is responsible for setting up and handling the page's UI, including\n * the page header, mobile mode handling, and sidebars. It also provides some\n * utilities for setting up common UI elements.\n *\n * The page will respect the ``-has-sidebar`` and ``-is-content-full-page``\n * CSS classes on the document ``<body>``. These will control the behavior\n * and layout of the page.\n *\n * This is intended for use by page views that are set by\n * :js:class:`RB.PageManager`.\n */\nRB.PageView = Backbone.View.extend({\n    /**\n     * The maximum frequency at which resize events should be handled.\n     *\n     * Subclasses can override this if they need to respond to window\n     * resizes at a faster or slower rate.\n     */\n    windowResizeThrottleMS: 100,\n\n    /**\n     * Initialize the page.\n     *\n     * Args:\n     *     options (object, optional):\n     *         Options for the page.\n     *\n     * Option Args:\n     *     $body (jQuery, optional):\n     *         The body element. This is useful for unit tests.\n     *\n     *     $headerBar (jQuery, optional):\n     *         The header bar element. This is useful for unit tests.\n     *\n     *     $pageContainer (jQuery, optional):\n     *         The page container element. This is useful for unit tests.\n     *\n     *     $pageContent (jQuery, optional):\n     *         The page content element. This is useful for unit tests.\n     *\n     *     $pageSidebar (jQuery, optional):\n     *         The page sidebar element. This is useful for unit tests.\n     */\n    initialize(options={}) {\n        this.options = options;\n\n        this.$window = $(window);\n        this.$pageContainer = null;\n        this.$pageContent = null;\n        this.$mainSidebar = null;\n        this._$pageSidebar = null;\n        this._$mainSidebarPane = null;\n\n        this.hasSidebar = null;\n        this.isFullPage = null;\n        this.inMobileMode = null;\n        this.isPageRendered = false;\n\n        this.drawer = null;\n        this.headerView = null;\n    },\n\n    /**\n     * Remove the page from the DOM and disable event handling.\n     */\n    remove() {\n        if (this.$window) {\n            this.$window.off('resize.rbPageView');\n        }\n\n        if (this.headerView) {\n            this.headerView.remove();\n        }\n\n        Backbone.View.prototype.remove.call(this);\n    },\n\n    /**\n     * Render the page.\n     *\n     * Subclasses should not override this. Instead, they should override\n     * :js:func:`RB.PageView.renderPage``.\n     *\n     * Returns:\n     *     RB.PageView:\n     *     This object, for chaining.\n     */\n    render() {\n        const options = this.options;\n        const $body = options.$body || $(document.body);\n\n        this.$pageContainer = options.$pageContainer || $('#page-container');\n        this.$pageContent = options.$pageContent || $('#content');\n        this._$pageSidebar = options.$pageSidebar || $('#page-sidebar');\n        this._$pageSidebarPanes = this._$pageSidebar.children(\n            '.rb-c-page-sidebar__panes');\n        this._$mainSidebarPane = this._$pageSidebarPanes.children(\n            '.rb-c-page-sidebar__pane.-is-shown');\n        this.$mainSidebar = this._$mainSidebarPane.children(\n            '.rb-c-page-sidebar__pane-content');\n\n        this.headerView = new RB.HeaderView({\n            el: options.$headerBar || $('#headerbar'),\n            $body: $body,\n            $pageSidebar: this._$pageSidebar,\n        });\n        this.headerView.render();\n\n        this.hasSidebar = $body.hasClass('-has-sidebar') ||\n                          $body.hasClass('has-sidebar');\n        this.isFullPage = $body.hasClass('-is-content-full-page') ||\n                          $body.hasClass('full-page-content');\n        this.inMobileMode = this.headerView.inMobileMode;\n\n        this.renderPage();\n\n        if (this.isFullPage) {\n            /*\n             * On full-size pages, we hide the content and sidebar initially\n             * (via CSS), so that we can properly position them before they're\n             * first shown. Now that we've done that, make them visible.\n             */\n            this._$mainSidebarPane.show();\n            this.$pageContainer.show();\n        }\n\n        this.$window.on('resize.rbPageView',\n                        _.throttle(() => this._updateSize(),\n                                   this.windowResizeThrottleMS));\n        this.listenTo(this.headerView, 'mobileModeChanged',\n                      this._onMobileModeChanged);\n        this._onMobileModeChanged(this.inMobileMode);\n\n        this.isPageRendered = true;\n\n        return this;\n    },\n\n    /**\n     * Set a drawer that can be shown over the sidebar.\n     *\n     * This is used by a page to set a drawer that should be displayed.\n     * Drawers are shown over the sidebar area in desktop mode, or docked to\n     * the bottom of the screen in mobile mode.\n     *\n     * Only one drawer can be set per page. Drawers also require a page with\n     * sidebars enabled.\n     *\n     * Callers must instantiate the drawer but should not render it or\n     * add it to the DOM.\n     *\n     * Args:\n     *     drawer (RB.Drawer):\n     *         The drawer to set.\n     */\n    setDrawer(drawer) {\n        console.assert(\n            this.drawer === null,\n            'A drawer has already been set up for this page.');\n        console.assert(\n            this.hasSidebar,\n            'Drawers can only be set up on pages with a sidebar.');\n\n        this.drawer = drawer;\n        drawer.render();\n        this._reparentDrawer();\n\n        this.listenTo(drawer, 'visibilityChanged', this._updateSize);\n    },\n\n    /**\n     * Render the page contents.\n     *\n     * This should be implemented by subclasses that need to render any\n     * UI elements.\n     */\n    renderPage() {\n    },\n\n    /**\n     * Resize an element to take the full height of a parent container.\n     *\n     * By default, this will size the element to the height of the main\n     * page container. A specific parent can be specified for more specific\n     * use cases.\n     *\n     * Args:\n     *     $el (jQuery):\n     *         The jQuery-wrapped element to resize.\n     *\n     *     $parent (jQuery, optional):\n     *         The specific jQuery-wrapped parent element to base the size on.\n     */\n    resizeElementForFullHeight($el, $parent) {\n        if ($parent === undefined) {\n            $parent = this.$pageContainer;\n        }\n\n        $el.outerHeight($parent.height() - $el.position().top);\n    },\n\n    /**\n     * Handle page resizes.\n     *\n     * This will be called whenever the page's size (or the window size)\n     * has changed, allowing subclasses to adjust any UI elements as\n     * appropriate.\n     *\n     * In the case of window sizes, calls to this function will be throttled,\n     * called no more frequently than the configured\n     * :js:attr:`windowResizeThrottleMS`.\n     */\n    onResize() {\n    },\n\n    /**\n     * Handle mobile mode changes.\n     *\n     * This will be called whenever the page goes between mobile/desktop\n     * mode, allowing subclasses to adjust any UI elements as appropriate.\n     *\n     * Args:\n     *     inMobileMode (bool):\n     *         Whether the UI is now in mobile mode. This will be the same\n     *         value as :js:attr:`inMobileMode`, and is just provided for\n     *         convenience.\n     */\n    onMobileModeChanged(inMobileMode) {\n    },\n\n    /**\n     * Update the size of the page.\n     *\n     * This will be called in response to window resizes and certain other\n     * events. It will calculate the appropriate size for the sidebar (if\n     * on the page) and the page container (if in full-page content mode),\n     * update any elements as appropriate, and then call\n     * :js:func:`RB.PageView.onResize` so that subclasses can update their\n     * elements.\n     */\n    _updateSize() {\n        const windowHeight = this.$window.height();\n        let pageContainerHeight = null;\n        let sidebarHeight = null;\n\n        if (this.isFullPage) {\n            pageContainerHeight = windowHeight -\n                                  this.$pageContainer.offset().top;\n        }\n\n        if (this.inMobileMode) {\n            if (pageContainerHeight !== null &&\n                this.drawer !== null &&\n                this.drawer.isVisible) {\n                /*\n                 * If we're constraining the page container's height, and\n                 * there's a drawer present, reduce the page container's\n                 * height by the drawer size, so we don't make some content\n                 * inaccessible due to an overlap.\n                 */\n                pageContainerHeight -= this.drawer.$el.outerHeight();\n            }\n        } else {\n            if (pageContainerHeight !== null) {\n                /*\n                 * If we're constraining the page container's height,\n                 * constrain the sidebar's as well.\n                 */\n                sidebarHeight = windowHeight - this._$pageSidebar.offset().top;\n            }\n        }\n\n        if (pageContainerHeight === null) {\n            this.$pageContainer.css('height', '');\n        } else {\n            this.$pageContainer.outerHeight(pageContainerHeight);\n        }\n\n        if (sidebarHeight === null) {\n            this._$pageSidebar.css('height', '');\n        } else {\n            this._$pageSidebar.outerHeight(sidebarHeight);\n        }\n\n        this.onResize();\n    },\n\n    /**\n     * Set the new parent for the drawer.\n     *\n     * In mobile mode, this will place the drawer within the main\n     * ``#container``, right before the sidebar, allowing it to appear docked\n     * along the bottom of the page.\n     *\n     * In desktop mode, this will place the drawer within the sidebar area,\n     * ensuring that it overlaps it properly.\n     */\n    _reparentDrawer() {\n        const $el = this.drawer.$el\n            .detach();\n\n        if (this.inMobileMode) {\n            $el.insertBefore(this._$pageSidebar);\n        } else {\n            $el.appendTo(this._$pageSidebarPanes);\n        }\n    },\n\n    /**\n     * Handle a transition between mobile and desktop mode.\n     *\n     * This will set the :js:attr:`inMobileMode` flag and trigger the\n     * ``inMobileModeChanged`` event, so that pages can listen and update\n     * their layout as appropriate.\n     *\n     * It will also update the size and reparent the drawer.\n     *\n     * Args:\n     *     inMobileMode (boolean):\n     *         Whether the page shell is in mobile mode.\n     */\n    _onMobileModeChanged(inMobileMode) {\n        this.inMobileMode = inMobileMode;\n\n        this._updateSize();\n\n        if (this.drawer !== null) {\n            this._reparentDrawer();\n        }\n\n        this.onMobileModeChanged(this.inMobileMode);\n        this.trigger('inMobileModeChanged', this.inMobileMode);\n    },\n});\n"]}