{"version":3,"sources":["inlineFormView.es6.js"],"names":[],"mappings":";;AAAA;;;;;;;AAOA,GAAG,KAAH,CAAS,cAAT,GAA0B,SAAS,IAAT,CAAc,MAAd,CAAqB;AAC3C,YAAQ;AACJ,wDAAgD;AAD5C,KADmC;;AAK3C;;;AAGA,cAR2C,wBAQ9B;AACT,aAAK,cAAL,GAAsB,IAAtB;AACA,aAAK,OAAL,GAAe,IAAf;AACH,KAX0C;;;AAa3C;;;;;;;AAOA,UApB2C,oBAoBlC;AACL,aAAK,cAAL,GAAsB,KAAK,CAAL,CAAO,wCAAP,CAAtB;AACA,aAAK,OAAL,GAAe,KAAK,CAAL,CAAO,sCAAP,CAAf;;AAEA,aAAK,QAAL,CAAc,KAAK,KAAnB,EAA0B,cAA1B,EAA0C,KAAK,eAA/C;;AAEA,eAAO,IAAP;AACH,KA3B0C;;;AA6B3C;;;;;;AAMA,mBAnC2C,6BAmCzB;AACd,YAAM,QAAQ,KAAK,KAAL,CAAW,GAAX,CAAe,OAAf,CAAd;AACA,YAAM,SAAS,KAAK,KAAL,CAAW,GAAX,CAAe,QAAf,CAAf;AACA,YAAM,UAAU,IAAI,MAAJ,OAAe,MAAf,yBAAhB;AACA,YAAM,YAAe,MAAf,SAAyB,KAA/B;;AAEA,iBAAS,eAAT,CAAyB,EAAzB,EAA6B;AACzB,gBAAI,GAAG,EAAP,EAAW;AACP,mBAAG,EAAH,GAAQ,GAAG,EAAH,CAAM,OAAN,CAAc,OAAd,EAAuB,SAAvB,CAAR;AACH;;AAED,gBAAI,GAAG,IAAP,EAAa;AACT,mBAAG,IAAH,GAAU,GAAG,IAAH,CAAQ,OAAR,CAAgB,OAAhB,EAAyB,SAAzB,CAAV;AACH;;AAED,gBAAI,GAAG,OAAP,EAAgB;AACZ,mBAAG,OAAH,GAAa,GAAG,OAAH,CAAW,OAAX,CAAmB,OAAnB,EAA4B,SAA5B,CAAb;AACH;;AAED,iBAAK,IAAI,OAAO,GAAG,UAAnB,EACK,SAAS,IADd,EAEK,OAAO,KAAK,WAFjB,EAE8B;AAC1B,gCAAgB,IAAhB;AACH;AACJ;;AAED,aAAK,EAAL,CAAQ,EAAR,GAAa,SAAb;AACA,aAAK,OAAL,CAAa,IAAb,QAAsB,QAAQ,CAA9B;;AAEA,wBAAgB,KAAK,EAArB;AACH,KAjE0C;;;AAmE3C;;;;;;;;;;AAUA,oBA7E2C,4BA6E1B,CA7E0B,EA6EvB;AAChB,YAAI,KAAK,KAAL,CAAW,GAAX,CAAe,WAAf,CAAJ,EAAiC;AAC7B;AACH;;AAED,UAAE,cAAF;AACA,UAAE,eAAF;;AAEA,YAAI,gFAAJ,EAAsF;AAClF,iBAAK,KAAL,CAAW,OAAX;AACH;AACJ;AAxF0C,CAArB,CAA1B","file":"inlineFormView.js","sourcesContent":["/**\n * A view managing inline forms, for related objects for models.\n *\n * This allows for providing form data for a database object that relates to\n * some primary object, or deleting the object. It's managed by\n * :js:class:`RB.Admin.InlineFormGroupView`.\n */\nRB.Admin.InlineFormView = Backbone.View.extend({\n    events: {\n        'click .rb-c-admin-form-inline__delete-action': '_onDeleteClicked',\n    },\n\n    /**\n     * Initialize the view.\n     */\n    initialize() {\n        this._$removeButton = null;\n        this._$title = null;\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.Admin.InlineFormView:\n     *     This view, for chaining.\n     */\n    render() {\n        this._$removeButton = this.$('.rb-c-admin-form-inline__delete-action');\n        this._$title = this.$('.rb-c-admin-form-inline__title-index');\n\n        this.listenTo(this.model, 'change:index', this._onIndexChanged);\n\n        return this;\n    },\n\n    /**\n     * Handle a change to the inline's index in the group.\n     *\n     * This will update the ID and title for this view, and the IDs, names,\n     * and references across all elements in the form.\n     */\n    _onIndexChanged() {\n        const index = this.model.get('index');\n        const prefix = this.model.get('prefix');\n        const idRegex = new RegExp(`(${prefix}-(\\\\d+|__prefix__))`);\n        const newPrefix = `${prefix}-${index}`;\n\n        function _updateElements(el) {\n            if (el.id) {\n                el.id = el.id.replace(idRegex, newPrefix);\n            }\n\n            if (el.name) {\n                el.name = el.name.replace(idRegex, newPrefix);\n            }\n\n            if (el.htmlFor) {\n                el.htmlFor = el.htmlFor.replace(idRegex, newPrefix);\n            }\n\n            for (let node = el.firstChild;\n                 node !== null;\n                 node = node.nextSibling) {\n                _updateElements(node);\n            }\n        }\n\n        this.el.id = newPrefix;\n        this._$title.text(`#${index + 1}`);\n\n        _updateElements(this.el);\n    },\n\n    /**\n     * Handle a click event on the Delete button for the inline.\n     *\n     * This will trigger the ``deleteClicked`` event, allowing the parent\n     * :js:class:`RB.Admin.InlineFormGroupView` to handle it.\n     *\n     * Args:\n     *     e (jQuery.Event):\n     *         The click event.\n     */\n    _onDeleteClicked(e) {\n        if (this.model.get('isInitial')) {\n            return;\n        }\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (confirm(gettext('Are you sure you want to delete this? This cannot be undone.'))) {\n            this.model.destroy();\n        }\n    },\n});\n"]}