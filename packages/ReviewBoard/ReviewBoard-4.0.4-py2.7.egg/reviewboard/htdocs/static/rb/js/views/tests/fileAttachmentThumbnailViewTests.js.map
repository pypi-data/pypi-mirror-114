{"version":3,"sources":["fileAttachmentThumbnailViewTests.es6.js"],"names":[],"mappings":"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","file":"fileAttachmentThumbnailViewTests.js","sourcesContent":["suite('rb/views/FileAttachmentThumbnail', function() {\n    let reviewRequest;\n    let model;\n    let view;\n\n    beforeEach(function() {\n        reviewRequest = new RB.ReviewRequest();\n        model = new RB.FileAttachment({\n            downloadURL: 'http://example.com/file.png',\n            filename: 'file.png',\n        });\n\n        spyOn(model, 'trigger').and.callThrough();\n    });\n\n    describe('Rendering', function() {\n        function expectElements() {\n            expect(view.$('a.edit').length).toBe(1);\n            expect(view.$('.file-caption').length).toBe(1);\n            expect(view.$('.file-actions').length).toBe(1);\n            expect(view.$('.file-delete').length).toBe(\n                view.options.canEdit && model.get('loaded') ? 1 : 0);\n            expect(view.$('.file-update').length).toBe(\n                view.options.canEdit && model.get('loaded') ? 1 : 0);\n        }\n\n        function expectAttributeMatches() {\n            expect(view.$('.file-download').attr('href')).toBe(\n                model.get('downloadURL'));\n            expect(view.$('.file-caption .edit').text()).toBe(\n                model.get('caption'));\n        }\n\n        it('Using existing elements', function() {\n            const $el = $('<div/>')\n                .addClass(RB.FileAttachmentThumbnail.prototype.className)\n                .html(RB.FileAttachmentThumbnail.prototype.template(\n                    _.defaults({\n                        caption: 'No caption',\n                        captionClass: 'edit empty-caption',\n                    }, model.attributes)));\n\n            model.set('loaded', true);\n\n            view = new RB.FileAttachmentThumbnail({\n                renderThumbnail: true,\n                reviewRequest: reviewRequest,\n                el: $el,\n                model: model,\n            });\n            $testsScratch.append(view.$el);\n            view.render();\n\n            expectElements();\n\n            expect(view.$('.file-actions').is(':visible')).toBe(true);\n            expect(view.$('.fa-spinner').length).toBe(0);\n        });\n\n        it('Rendered thumbnail with unloaded model', function() {\n            view = new RB.FileAttachmentThumbnail({\n                reviewRequest: reviewRequest,\n                renderThumbnail: true,\n                model: model,\n            });\n            $testsScratch.append(view.$el);\n            view.render();\n\n            expectElements();\n\n            expect(view.$('.file-actions').children().length).toBe(0);\n            expect(view.$('.fa-spinner').length).toBe(1);\n        });\n\n        describe('Rendered thumbnail with loaded model', function() {\n            beforeEach(function() {\n                model.id = 123;\n                model.attributes.id = 123;\n                model.set('caption', 'My Caption');\n                model.set('loaded', true);\n                model.url = '/api/file-attachments/123/';\n            });\n\n            it('With review UI', function() {\n                model.set('reviewURL', '/review/');\n\n                view = new RB.FileAttachmentThumbnail({\n                    reviewRequest: reviewRequest,\n                    renderThumbnail: true,\n                    model: model,\n                });\n                $testsScratch.append(view.$el);\n                view.render();\n\n                expectElements();\n                expectAttributeMatches();\n\n                expect(view.$('.file-actions').children().length).toBe(2);\n                expect(view.$('.fa-spinner').length).toBe(0);\n                expect(view.$('.file-review').length).toBe(1);\n                expect(view.$('.file-add-comment').length).toBe(0);\n            });\n\n            it('No review UI', function() {\n                view = new RB.FileAttachmentThumbnail({\n                    reviewRequest: reviewRequest,\n                    renderThumbnail: true,\n                    model: model,\n                });\n                $testsScratch.append(view.$el);\n                view.render();\n\n                expectElements();\n                expectAttributeMatches();\n\n                expect(view.$('.file-actions').children().length).toBe(2);\n                expect(view.$('.fa-spinner').length).toBe(0);\n                expect(view.$('.file-review').length).toBe(0);\n                expect(view.$('.file-add-comment').length).toBe(1);\n            });\n        });\n    });\n\n    describe('Actions', function() {\n        beforeEach(function() {\n            model.id = 123;\n            model.attributes.id = 123;\n            model.set('loaded', true);\n            model.url = '/api/file-attachments/123/';\n\n            view = new RB.FileAttachmentThumbnail({\n                canEdit: true,\n                reviewRequest: reviewRequest,\n                renderThumbnail: true,\n                model: model,\n            });\n            $testsScratch.append(view.$el);\n            view.render();\n\n            spyOn(view, 'trigger').and.callThrough();\n        });\n\n        it('Begin caption editing', function() {\n            view._captionEditorView.startEdit();\n            expect(view.trigger).toHaveBeenCalledWith('beginEdit');\n        });\n\n        it('Cancel caption editing', function() {\n            view._captionEditorView.startEdit();\n            expect(view.trigger).toHaveBeenCalledWith('beginEdit');\n\n            view._captionEditorView.cancel();\n            expect(view.trigger).toHaveBeenCalledWith('endEdit');\n        });\n\n        it('Save caption', function() {\n            spyOn(model, 'save');\n\n            view._captionEditorView.startEdit();\n            expect(view.trigger).toHaveBeenCalledWith('beginEdit');\n\n            view.$('input')\n                .val('Foo')\n                .triggerHandler('keyup');\n            view._captionEditorView.submit();\n\n            expect(view.trigger).toHaveBeenCalledWith('endEdit');\n            expect(model.get('caption')).toBe('Foo');\n            expect(model.save).toHaveBeenCalled();\n        });\n\n        it('Delete', function() {\n            spyOn(model, 'destroy').and.callThrough();\n            spyOn($, 'ajax').and.callFake(options => options.success());\n            spyOn(view.$el, 'fadeOut').and.callFake(done => done());\n            spyOn(view, 'remove');\n\n            view.$('.file-delete').click();\n\n            expect($.ajax).toHaveBeenCalled();\n            expect(model.destroy).toHaveBeenCalled();\n            expect(model.trigger.calls.argsFor(2)[0]).toBe('destroying');\n            expect(view.$el.fadeOut).toHaveBeenCalled();\n            expect(view.remove).toHaveBeenCalled();\n        });\n    });\n});\n"]}