{"version":3,"sources":["reviewReplyEditorViewTests.es6.js"],"names":[],"mappings":"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","file":"reviewReplyEditorViewTests.js","sourcesContent":["suite('rb/reviewRequestPage/views/ReviewReplyEditorView', function() {\n    let reviewReply;\n    let editor;\n    let view;\n\n    beforeEach(function() {\n        const $container = $('<div/>').appendTo($testsScratch);\n\n        reviewReply = new RB.ReviewReply({\n            id: 121\n        });\n\n        /* Some tests will invoke this, so just pretend it works. */\n        spyOn(reviewReply, 'discardIfEmpty').and.callFake(\n            (options, context) => options.success.call(context));\n\n        editor = new RB.ReviewRequestPage.ReviewReplyEditor({\n            anchorPrefix: 'header-reply',\n            replyObject: reviewReply,\n            review: new RB.Review({\n                id: 42,\n                parentObject: new RB.ReviewRequest(),\n            }),\n            reviewReply: reviewReply,\n            contextType: 'rcbt',\n            contextID: '100',\n        });\n\n        view = new RB.ReviewRequestPage.ReviewReplyEditorView({\n            model: editor,\n            el: $testsScratch,\n        });\n\n        /* Necessary to do pre-render so we can use makeCommentElement. */\n        view._$commentsList = $('<ul class=\"reply-comments\"/>');\n\n        $container\n            .append(view._$commentsList)\n            .append($('<a href=\"#\" class=\"add_comment_link\">New Comment</a>'));\n    });\n\n    describe('Construction', function() {\n        it('Populate from draft comment', function() {\n            const commentText = 'Test comment';\n            const now = moment();\n            const $el = view._makeCommentElement({\n                commentID: 16,\n                now: now,\n                text: commentText,\n            });\n\n            view.render();\n\n            expect(editor.get('commentID')).toBe(16);\n            expect(editor.get('text')).toBe(commentText);\n            expect(editor.get('hasDraft')).toBe(true);\n            expect(editor.get('timestamp').valueOf())\n                .toBe(now.milliseconds(0).valueOf());\n            expect(view._$draftComment[0]).toBe($el[0]);\n            expect(view._$addCommentLink.is(':visible')).toBe(false);\n        });\n    });\n\n    describe('Actions', function() {\n        it('Add comment link', function() {\n            view.render();\n\n            expect(view._$addCommentLink.is(':visible')).toBe(true);\n            view._$addCommentLink.click();\n\n            expect(view._$addCommentLink.is(':visible')).toBe(false);\n            expect(view._$draftComment).not.toBe(null);\n            expect(view._$draftComment.hasClass('draft')).toBe(true);\n        });\n    });\n\n    describe('Event handling', function() {\n        it('Comment discarded', function() {\n            view._makeCommentElement({\n                text: 'Test comment',\n            });\n\n            view.render();\n\n            let $el = view.$('.reply-comments li');\n            expect($el.length).toBe(1);\n\n            reviewReply.trigger('destroyed');\n\n            $el = view.$('.reply-comments li');\n            expect($el.length).toBe(0);\n            expect(view._$draftComment).toBe(null);\n        });\n\n        it('Comment published', function() {\n            const $draftEl = view._makeCommentElement({\n                commentID: 16,\n            });\n\n            spyOn($.fn, 'user_infobox').and.callThrough();\n            spyOn($.fn, 'timesince').and.callThrough();\n\n            view.render();\n            editor.set('text', 'Test **comment**');\n            reviewReply.trigger('published');\n\n            const $el = view.$('.reply-comments li');\n\n            expect($el.length).toBe(1);\n            expect($draftEl).not.toBe($el);\n            expect($el.hasClass('draft')).toBe(false);\n            expect($el.data('comment-id')).toBe(16);\n            expect(view._$draftComment).toBe(null);\n            expect($.fn.user_infobox).toHaveBeenCalled();\n            expect($.fn.timesince).toHaveBeenCalled();\n\n            const $anchor = $el.children('.comment-anchor');\n            expect($anchor.length).toBe(1);\n            expect($anchor.attr('name')).toBe('header-reply121');\n\n            const $floatingAnchor = $el.find('> .floating-anchor > a');\n            expect($floatingAnchor.length).toBe(1);\n            expect($floatingAnchor.attr('href')).toBe('#header-reply121');\n            expect($floatingAnchor.hasClass('fa fa-link fa-flip-horizontal'))\n                .toBe(true);\n        });\n    });\n\n    describe('Methods', function() {\n        it('openCommentEditor', function() {\n            view.render();\n\n            expect(view._$addCommentLink.is(':visible')).toBe(true);\n            expect(view._$draftComment).toBe(null);\n\n            view.openCommentEditor();\n\n            expect(view._$addCommentLink.is(':visible')).toBe(false);\n            expect(view._$draftComment).not.toBe(null);\n            expect(view._$draftComment.hasClass('draft')).toBe(true);\n        });\n    });\n\n    describe('Text rendering', function() {\n        function testRendering(richText, expectedHTML) {\n            view.render();\n\n            const $comment = view._makeCommentElement({\n                text: '<p><strong>Test</strong> &amp;lt;</p>',\n                richText: richText,\n            });\n\n            const $reviewText = $comment.find('.reviewtext');\n            expect($reviewText.length).toBe(1);\n            expect($reviewText.hasClass('rich-text')).toBe(richText);\n            expect($reviewText.html()).toBe(expectedHTML);\n        }\n\n        it('richText=true', function() {\n            testRendering(true, '<p><strong>Test</strong> &amp;lt;</p>');\n        });\n\n        it('richText=false', function() {\n            testRendering(false,\n                          '&lt;p&gt;&lt;strong&gt;Test&lt;/strong&gt; ' +\n                          '&amp;amp;lt;&lt;/p&gt;');\n        });\n    });\n});\n"]}