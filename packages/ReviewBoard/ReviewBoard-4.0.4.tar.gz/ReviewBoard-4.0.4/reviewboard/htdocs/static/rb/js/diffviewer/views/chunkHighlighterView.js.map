{"version":3,"sources":["chunkHighlighterView.es6.js"],"names":[],"mappings":";;AAAA;;;;;;;;;;AAUA,GAAG,oBAAH,GAA0B,SAAS,IAAT,CAAc,MAAd,CAAqB;AAC3C,eAAW,gBADgC;;AAG3C;;;AAGA,cAN2C,wBAM9B;AACT,aAAK,QAAL,GAAgB,IAAhB;AACA,aAAK,iBAAL,GAAyB,IAAzB;AACA,aAAK,eAAL,GAAuB,IAAvB;AACA,aAAK,QAAL,GAAgB,EAAE,MAAF,CAAhB;AACA,aAAK,gBAAL,GAAwB,IAAxB;AACA,aAAK,QAAL,GAAgB,IAAhB;AACA,aAAK,WAAL,GAAmB,IAAnB;;AAEA,UAAE,OAAF,CAAU,IAAV,EAAgB,cAAhB;AACH,KAhB0C;;;AAkB3C;;;;;;;;;;AAUA,UA5B2C,oBA4BlC;AAAA;;AACL,aAAK,QAAL,CAAc,EAAd,CAAiB,YAAY,KAAK,GAAlC,EAAuC,YAAM;AACzC,gBAAM,cAAc,MAAK,QAAL,CAAc,KAAd,EAApB;;AAEA,gBAAI,gBAAgB,MAAK,gBAAzB,EAA2C;AACvC,sBAAK,gBAAL,GAAwB,WAAxB;;AAEA,sBAAK,YAAL;AACH;AACJ,SARD;;AAUA,aAAK,eAAL,GAAuB,EAAE,iBAAF,CAAvB;;AAEA,aAAK,YAAL;;AAEA,eAAO,IAAP;AACH,KA5C0C;;;AA8C3C;;;AAGA,UAjD2C,oBAiDlC;AACL,iBAAS,IAAT,CAAc,SAAd,CAAwB,MAAxB,CAA+B,IAA/B,CAAoC,IAApC;;AAEA,aAAK,QAAL,CAAc,GAAd,CAAkB,KAAK,GAAvB;AACH,KArD0C;;;AAuD3C;;;;;;;;;;AAUA,aAjE2C,qBAiEjC,MAjEiC,EAiEzB;AACd,aAAK,QAAL,GAAgB,OAAO,CAAP,CAAhB;AACA,aAAK,iBAAL,GAAyB,OAAO,OAAP,CAAe,iBAAf,EAAkC,CAAlC,CAAzB;;AAEA,aAAK,YAAL;AACH,KAtE0C;;;AAwE3C;;;AAGA,gBA3E2C,0BA2E5B;AACX,YAAM,UAAU,KAAK,QAArB;;AAEA,YAAI,CAAC,OAAL,EAAc;AACV;AACH;;AAED,YAAI,UAAU,KAAd;AACA,YAAM,MAAM,EAAZ;;AAEA;;;;;;AAMA,YAAM,MAAM,KAAK,KAAL,CAAW,QAAQ,SAAR,GACA,KAAK,iBAAL,CAAuB,SADvB,GACmC,CAD9C,CAAZ;AAEA,YAAM,SAAS,QAAQ,YAAR,GAAuB,CAAtC;;AAEA,YAAI,QAAQ,KAAK,QAAjB,EAA2B;AACvB,gBAAI,GAAJ,GAAU,GAAV;AACA,iBAAK,QAAL,GAAgB,GAAhB;AACA,sBAAU,IAAV;AACH;;AAED,YAAI,WAAW,KAAK,WAApB,EAAiC;AAC7B,gBAAI,MAAJ,GAAa,MAAb;AACA,iBAAK,WAAL,GAAmB,MAAnB;AACA,sBAAU,IAAV;AACH;;AAED,YAAI,OAAJ,EAAa;AACT;;;;;;;;;AASA,gBAAM,UAAU,KAAK,eAAL,CAAqB,UAArB,CAAgC,GAAhC,EAAqC,GAArC,CAAhB;AACA,gBAAI,IAAJ,GAAW,CAAC,OAAZ;AACA,gBAAI,KAAJ,GAAY,CAAC,OAAb;;AAEA,iBAAK,GAAL,CAAS,GAAT,CAAa,GAAb;AACH;AACJ;AA3H0C,CAArB,CAA1B","file":"chunkHighlighterView.js","sourcesContent":["/**\n * Highlights a chunk of the diff.\n *\n * This will create and move four border elements around the chunk. We use\n * these border elements instead of setting a border since few browsers\n * render borders on <tbody> tags the same, and give us few options for\n * styling.\n *\n * In practice, there's only ever one highlighter on a page at a time.\n */\nRB.ChunkHighlighterView = Backbone.View.extend({\n    className: 'diff-highlight',\n\n    /**\n     * Initialize the highlighter.\n     */\n    initialize() {\n        this._chunkEl = null;\n        this._chunkContainerEl = null;\n        this._$pageContainer = null;\n        this._$window = $(window);\n        this._prevWindowWidth = null;\n        this._prevTop = null;\n        this._prevHeight = null;\n\n        _.bindAll(this, 'updateLayout');\n    },\n\n    /**\n     * Render the highlighter to the page.\n     *\n     * This will create all the border elements and compute any variables\n     * we want to keep around for further rendering.\n     *\n     * Returns:\n     *     RB.ChunkHighlighterView:\n     *     This object, for chaining.\n     */\n    render() {\n        this._$window.on('resize.' + this.cid, () => {\n            const windowWidth = this._$window.width();\n\n            if (windowWidth !== this._prevWindowWidth) {\n                this._prevWindowWidth = windowWidth;\n\n                this.updateLayout();\n            }\n        });\n\n        this._$pageContainer = $('#page-container');\n\n        this.updateLayout();\n\n        return this;\n    },\n\n    /**\n     * Remove the highlighter from the page and disconnects all events.\n     */\n    remove() {\n        Backbone.View.prototype.remove.call(this);\n\n        this._$window.off(this.cid);\n    },\n\n    /**\n     * Highlight a new chunk element.\n     *\n     * The borders will surround the chunk element and track its position\n     * and size as the page updates.\n     *\n     * Args:\n     *     $chunk (jQuery):\n     *         The chunk element to highlight.\n     */\n    highlight($chunk) {\n        this._chunkEl = $chunk[0];\n        this._chunkContainerEl = $chunk.parents('.diff-container')[0];\n\n        this.updateLayout();\n    },\n\n    /**\n     * Update of the position of the highlighter.\n     */\n    updateLayout() {\n        const chunkEl = this._chunkEl;\n\n        if (!chunkEl) {\n            return;\n        }\n\n        let changed = false;\n        const css = {};\n\n        /*\n         * NOTE: We're hard-coding the border widths (1px) so we don't have to\n         *       look them up. The borders aren't directly on the chunk (and\n         *       may not even be on a child of this chunk), and it's a bit\n         *       slow to look these up.\n         */\n        const top = Math.floor(chunkEl.offsetTop +\n                               this._chunkContainerEl.offsetTop + 1);\n        const height = chunkEl.clientHeight + 1;\n\n        if (top !== this._prevTop) {\n            css.top = top;\n            this._prevTop = top;\n            changed = true;\n        }\n\n        if (height !== this._prevHeight) {\n            css.height = height;\n            this._prevHeight = height;\n            changed = true;\n        }\n\n        if (changed) {\n            /*\n             * If the positions of the chunk changed, then it's possible the\n             * page container's padding has also changed (zooming in/out), so\n             * be safe and recompute.\n             *\n             * Technically we should compute separately for the left and right\n             * sides, but in practice we apply even spacing. Save a\n             * calculation, since this happens in resize events.\n             */\n            const padding = this._$pageContainer.getExtents('p', 'l');\n            css.left = -padding;\n            css.right = -padding;\n\n            this.$el.css(css);\n        }\n    },\n});\n"]}