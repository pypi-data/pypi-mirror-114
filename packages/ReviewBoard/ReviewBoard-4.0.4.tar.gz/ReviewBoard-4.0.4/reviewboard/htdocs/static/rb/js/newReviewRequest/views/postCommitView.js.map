{"version":3,"sources":["postCommitView.es6.js"],"names":[],"mappings":"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","file":"postCommitView.js","sourcesContent":["/**\n * A view orchestrating post-commit review request creation.\n *\n * This brings together the BranchesView and CommitsView to provide a UI for\n * letting people browse through the committed revisions in the repository. When\n * the user clicks on one of the commits, it will create a new review request\n * using that commit's ID.\n */\nRB.PostCommitView = Backbone.View.extend({\n    className: 'post-commit',\n\n    loadErrorTemplate: _.template(dedent`\n        <div class=\"error\">\n         <p><%- errorLoadingText %></p>\n         <p class=\"error-text\">\n          <% _.each(errorLines, function(line) { %><%- line %><br /><% }); %>\n         </p>\n         <p>\n          <%- temporaryFailureText %>\n          <a href=\"#\" id=\"reload_<%- reloadID %>\"><%- tryAgainText %></a>\n         </p>\n        </div>\n    `),\n\n    events: {\n        'click #reload_branches': '_loadBranches',\n        'click #reload_commits': '_loadCommits',\n    },\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the view.\n     *\n     * Option Args:\n     *     $scrollContainer (jQuery):\n     *         The parent container handling all content scrolling.\n     */\n    initialize(options) {\n        const model = this.model;\n        const repository = model.get('repository');\n        const branches = repository.branches;\n\n        this._$scrollContainer = options.$scrollContainer;\n        this._$error = null;\n\n        // Set up the branch selector and bind it to the \"branch\" attribute\n        this._branchesView = new RB.BranchesView({\n            collection: branches,\n        });\n        this._branchesView.on('selected',\n                              branch => model.set('branch', branch));\n\n        this.listenTo(model, 'change:branch', this._onBranchChanged);\n\n        if (!branches.loaded) {\n            this._loadBranches();\n        }\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.PostCommitView:\n     *     This object, for chaining.\n     */\n    render() {\n        this._rendered = true;\n\n        $('<div/>')\n            .addClass('branches section-header')\n            .append($('<span/>')\n                .text(gettext('Create from an existing commit on:')))\n            .append(this._branchesView.render().el)\n            .appendTo(this.$el);\n\n        if (this._commitsView) {\n            this.$el.append(this._commitsView.render().el);\n        }\n\n        return this;\n    },\n\n    /**\n     * Load the list of branches from the repository.\n     *\n     * If there's an error loading the branches, the branches selector and\n     * commits list will be hidden, and an error will be displayed along\n     * with the message from the server. The user will have the ability to\n     * try again.\n     */\n    _loadBranches() {\n        this._clearLoadError();\n\n        const branches = this.model.get('repository').branches;\n\n        branches.fetch({\n            success: () => {\n                branches.loaded = true;\n\n                this._branchesView.$el.show();\n\n                if (this._commitsView) {\n                    this._commitsView.$el.show();\n                }\n            },\n            error: (collection, xhr) => {\n                this._branchesView.$el.hide();\n\n                if (this._commitsView) {\n                    this._commitsView.$el.hide();\n                }\n\n                this._showLoadError('branches', xhr);\n            },\n        });\n    },\n\n    /**\n     * Load the list of commits from the repository.\n     *\n     * If there's an error loading the commits, the commits list will be\n     * hidden, and an error will be displayed along with the message from\n     * the server. The user will have the ability to try again.\n     */\n    _loadCommits() {\n        this._clearLoadError();\n\n        this._commitsCollection.fetch({\n            success: () => {\n                this._commitsView.$el.show();\n                this._commitsView.checkFetchNext();\n            },\n            error: (collection, xhr) => {\n                this._commitsView.$el.hide();\n                this._showLoadError('commits', xhr);\n            },\n        });\n    },\n\n    /**\n     * Clear any displayed error message.\n     */\n    _clearLoadError() {\n        if (this._$error) {\n            this._$error.remove();\n            this._$error = null;\n        }\n    },\n\n    /**\n     * Show an error message indicating a load failure.\n     *\n     * The message from the server will be displayed along with some\n     * helpful text and a link for trying the request again.\n     *\n     * Args:\n     *     reloadID (string):\n     *         An ID to use for the reload link element.\n     *\n     *     xhr (jqXHR):\n     *         The HTTP Request object.\n     */\n    _showLoadError(reloadID, xhr) {\n        this._clearLoadError();\n\n        this._$error = $(this.loadErrorTemplate({\n                errorLoadingText: gettext('There was an error loading information from this repository:'),\n                temporaryFailureText: gettext('This may be a temporary failure.'),\n                tryAgainText: gettext('Try again'),\n                errorLines: xhr.errorText.split('\\n'),\n                reloadID: reloadID,\n            }))\n            .appendTo(this.$el);\n    },\n\n    /**\n     * Callback for when the user chooses a different branch.\n     *\n     * Fetches a new list of commits starting from the tip of the selected\n     * branch.\n     *\n     * Args:\n     *     model (RB.PostCommitModel):\n     *         The data model.\n     *\n     *     branch (RB.RepositoryBranch):\n     *         The selected branch.\n     */\n    _onBranchChanged(model, branch) {\n        if (this._commitsView) {\n            this.stopListening(this._commitsCollection);\n            this._commitsView.remove();\n        }\n\n        this._commitsCollection =\n            this.model.get('repository').getCommits({\n                branch: branch.id,\n                start: branch.get('commit'),\n            });\n        this.listenTo(this._commitsCollection, 'create',\n                      this._onCreateReviewRequest);\n\n        this._commitsView = new RB.CommitsView({\n            collection: this._commitsCollection,\n            $scrollContainer: this._$scrollContainer,\n        });\n        this.listenTo(this._commitsView, 'loadError', xhr => {\n            this._showLoadError('commits', xhr);\n        });\n\n        if (this._rendered) {\n            this.$el.append(this._commitsView.render().el);\n        }\n\n        this._loadCommits();\n    },\n\n    /**\n     * Callback for when a commit is selected.\n     *\n     * Creates a new review request with the given commit ID and redirects the\n     * browser to it.\n     *\n     * Args:\n     *     commit (RB.RepositoryCommit):\n     *         The selected commit.\n     */\n    _onCreateReviewRequest(commit) {\n        if (this._createPending) {\n            // Do nothing\n            return;\n        }\n\n        this._createPending = true;\n        this._commitsView.setPending(commit);\n\n        const repository = this.model.get('repository');\n        const reviewRequest = new RB.ReviewRequest({\n            repository: repository.id,\n            localSitePrefix: repository.get('localSitePrefix')\n        });\n\n        reviewRequest.createFromCommit({\n            commitID: commit.id,\n            success: () => {\n                window.location = reviewRequest.get('reviewURL');\n            },\n            error: (model, xhr) => {\n                this._commitsView.setPending(null);\n                this._createPending = false;\n                alert(xhr.errorText);\n            },\n        });\n    },\n});\n"]}