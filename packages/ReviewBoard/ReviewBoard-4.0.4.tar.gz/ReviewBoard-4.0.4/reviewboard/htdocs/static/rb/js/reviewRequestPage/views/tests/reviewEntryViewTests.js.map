{"version":3,"sources":["reviewEntryViewTests.es6.js"],"names":[],"mappings":"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","file":"reviewEntryViewTests.js","sourcesContent":["suite('rb/reviewRequestPage/views/ReviewEntryView', function() {\n    const template = dedent`\n        <div class=\"review review-request-page-entry\">\n         <div class=\"review-request-page-entry-contents\">\n          <div class=\"collapse-button\"></div>\n          <div class=\"banners\">\n           <input type=\"button\" value=\"Publish\" />\n           <input type=\"button\" value=\"Discard\" />\n          </div>\n          <div class=\"comment-section\" data-context-type=\"body_top\">\n           <a class=\"add_comment_link\"></a>\n           <ul class=\"reply-comments\">\n            <li class=\"draft\" data-comment-id=\"456\">\n             <pre class=\"reviewtext\"></pre>\n            </li>\n           </ul>\n          </div>\n          <div class=\"comment-section\" data-context-id=\"123\"\n               data-context-type=\"diff_comments\">\n           <a class=\"add_comment_link\"></a>\n           <ul class=\"reply-comments\"></ul>\n          </div>\n          <div class=\"comment-section\" data-context-type=\"body_bottom\">\n           <a class=\"add_comment_link\"></a>\n           <ul class=\"reply-comments\"></ul>\n          </div>\n         </div>\n        </div>\n    `;\n    let view;\n    let reviewView;\n    let reviewReply;\n\n    beforeEach(function() {\n        const reviewRequest = new RB.ReviewRequest();\n        const editor = new RB.ReviewRequestEditor({\n            reviewRequest: reviewRequest\n        });\n        const review = reviewRequest.createReview({\n            loaded: true,\n            links: {\n                replies: {\n                    href: '/api/review/123/replies/',\n                },\n            },\n        });\n        const model = new RB.ReviewRequestPage.ReviewEntry({\n            review: review,\n            reviewRequest: reviewRequest,\n            reviewRequestEditor: editor,\n        });\n        const $el = $(template).appendTo($testsScratch);\n\n        reviewReply = review.createReply();\n\n        view = new RB.ReviewRequestPage.ReviewEntryView({\n            el: $el,\n            model: model,\n        });\n\n        view.render();\n\n        reviewView = view._reviewView;\n\n        /* Don't allow the draft banner to show. */\n        spyOn(reviewView, '_showReplyDraftBanner');\n        spyOn(reviewView, 'trigger').and.callThrough();\n\n        reviewView._setupNewReply(reviewReply);\n    });\n\n    describe('Actions', function() {\n        it('Toggle collapse', function() {\n            const $box = view.$('.review-request-page-entry-contents');\n            const $collapseButton = view.$('.collapse-button');\n\n            $collapseButton.click();\n            expect($box.hasClass('collapsed')).toBe(true);\n            $collapseButton.click();\n            expect($box.hasClass('collapsed')).toBe(false);\n        });\n    });\n\n    describe('Draft banner', function() {\n        describe('Visibility', function() {\n            it('Shown on hasDraft', function() {\n                const editor = reviewView._replyEditorViews[1].model;\n\n                reviewView._showReplyDraftBanner.calls.reset();\n\n                expect(editor.get('hasDraft')).toBe(false);\n                expect(reviewView._showReplyDraftBanner).not.toHaveBeenCalled();\n\n                editor.set('hasDraft', true);\n                expect(reviewView._showReplyDraftBanner).toHaveBeenCalled();\n            });\n        });\n    });\n\n    describe('Methods', function() {\n        it('collapse', function() {\n            view.collapse();\n            expect(\n                view.$('.review-request-page-entry-contents')\n                    .hasClass('collapsed'))\n                .toBe(true);\n        });\n\n        it('expand', function() {\n            const $box = view.$('.review-request-page-entry-contents')\n                .addClass('collapsed');\n            view.expand();\n            expect($box.hasClass('collapsed')).toBe(false);\n        });\n\n        describe('getReviewReplyEditorView', function() {\n            it('With body_top', function() {\n                const editorView = view.getReviewReplyEditorView('body_top');\n\n                expect(editorView).not.toBe(undefined);\n                expect(editorView).toBe(reviewView._replyEditorViews[0]);\n            });\n\n            it('With body_bottom', function() {\n                const editorView = view.getReviewReplyEditorView('body_bottom');\n\n                expect(editorView).not.toBe(undefined);\n                expect(editorView).toBe(reviewView._replyEditorViews[2]);\n            });\n\n            it('With comments', function() {\n                const editorView = view.getReviewReplyEditorView('diff_comments',\n                                                                 123);\n\n                expect(editorView).not.toBe(undefined);\n                expect(editorView).toBe(reviewView._replyEditorViews[1]);\n            });\n        });\n    });\n});\n"]}