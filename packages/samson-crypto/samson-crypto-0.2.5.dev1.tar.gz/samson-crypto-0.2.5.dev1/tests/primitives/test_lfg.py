from samson.prngs.lfg import LFG
from samson.core.prng import PRNG
from samson.utilities.bytes import Bytes
from samson.math.general import next_prime
import unittest


# Test vector manually generated using Go's Additive LFG.
# Reference code:

# package main

# import (
# 	"fmt"
# 	"math/rand"
# )

# func main() {
#     s2 := rand.NewSource(42)
#     r2 := rand.New(s2)
#     for i := 0; i < 500; i++ {
#         fmt.Printf("%d, ", r2.Uint64());
#     }
# }


# Reference code for viewing internal state:

# package main

# import (
# 	"fmt"
# )

# const (
# 	rngLen   = 607
# 	rngTap   = 273
# 	rngMax   = 1 << 63
# 	rngMask  = rngMax - 1
# 	int32max = (1 << 31) - 1
# )

# var (
# 	// rngCooked used for seeding. See gen_cooked.go for details.
# 	rngCooked [rngLen]int64 = [...]int64{
# 		-4181792142133755926, -4576982950128230565, 1395769623340756751, 5333664234075297259,
# 		-6347679516498800754, 9033628115061424579, 7143218595135194537, 4812947590706362721,
# 		7937252194349799378, 5307299880338848416, 8209348851763925077, -7107630437535961764,
# 		4593015457530856296, 8140875735541888011, -5903942795589686782, -603556388664454774,
# 		-7496297993371156308, 113108499721038619, 4569519971459345583, -4160538177779461077,
# 		-6835753265595711384, -6507240692498089696, 6559392774825876886, 7650093201692370310,
# 		7684323884043752161, -8965504200858744418, -2629915517445760644, 271327514973697897,
# 		-6433985589514657524, 1065192797246149621, 3344507881999356393, -4763574095074709175,
# 		7465081662728599889, 1014950805555097187, -4773931307508785033, -5742262670416273165,
# 		2418672789110888383, 5796562887576294778, 4484266064449540171, 3738982361971787048,
# 		-4699774852342421385, 10530508058128498, -589538253572429690, -6598062107225984180,
# 		8660405965245884302, 10162832508971942, -2682657355892958417, 7031802312784620857,
# 		6240911277345944669, 831864355460801054, -1218937899312622917, 2116287251661052151,
# 		2202309800992166967, 9161020366945053561, 4069299552407763864, 4936383537992622449,
# 		457351505131524928, -8881176990926596454, -6375600354038175299, -7155351920868399290,
# 		4368649989588021065, 887231587095185257, -3659780529968199312, -2407146836602825512,
# 		5616972787034086048, -751562733459939242, 1686575021641186857, -5177887698780513806,
# 		-4979215821652996885, -1375154703071198421, 5632136521049761902, -8390088894796940536,
# 		-193645528485698615, -5979788902190688516, -4907000935050298721, -285522056888777828,
# 		-2776431630044341707, 1679342092332374735, 6050638460742422078, -2229851317345194226,
# 		-1582494184340482199, 5881353426285907985, 812786550756860885, 4541845584483343330,
# 		-6497901820577766722, 4980675660146853729, -4012602956251539747, -329088717864244987,
# 		-2896929232104691526, 1495812843684243920, -2153620458055647789, 7370257291860230865,
# 		-2466442761497833547, 4706794511633873654, -1398851569026877145, 8549875090542453214,
# 		-9189721207376179652, -7894453601103453165, 7297902601803624459, 1011190183918857495,
# 		-6985347000036920864, 5147159997473910359, -8326859945294252826, 2659470849286379941,
# 		6097729358393448602, -7491646050550022124, -5117116194870963097, -896216826133240300,
# 		-745860416168701406, 5803876044675762232, -787954255994554146, -3234519180203704564,
# 		-4507534739750823898, -1657200065590290694, 505808562678895611, -4153273856159712438,
# 		-8381261370078904295, 572156825025677802, 1791881013492340891, 3393267094866038768,
# 		-5444650186382539299, 2352769483186201278, -7930912453007408350, -325464993179687389,
# 		-3441562999710612272, -6489413242825283295, 5092019688680754699, -227247482082248967,
# 		4234737173186232084, 5027558287275472836, 4635198586344772304, -536033143587636457,
# 		5907508150730407386, -8438615781380831356, 972392927514829904, -3801314342046600696,
# 		-4064951393885491917, -174840358296132583, 2407211146698877100, -1640089820333676239,
# 		3940796514530962282, -5882197405809569433, 3095313889586102949, -1818050141166537098,
# 		5832080132947175283, 7890064875145919662, 8184139210799583195, -8073512175445549678,
# 		-7758774793014564506, -4581724029666783935, 3516491885471466898, -8267083515063118116,
# 		6657089965014657519, 5220884358887979358, 1796677326474620641, 5340761970648932916,
# 		1147977171614181568, 5066037465548252321, 2574765911837859848, 1085848279845204775,
# 		-5873264506986385449, 6116438694366558490, 2107701075971293812, -7420077970933506541,
# 		2469478054175558874, -1855128755834809824, -5431463669011098282, -9038325065738319171,
# 		-6966276280341336160, 7217693971077460129, -8314322083775271549, 7196649268545224266,
# 		-3585711691453906209, -5267827091426810625, 8057528650917418961, -5084103596553648165,
# 		-2601445448341207749, -7850010900052094367, 6527366231383600011, 3507654575162700890,
# 		9202058512774729859, 1954818376891585542, -2582991129724600103, 8299563319178235687,
# 		-5321504681635821435, 7046310742295574065, -2376176645520785576, -7650733936335907755,
# 		8850422670118399721, 3631909142291992901, 5158881091950831288, -6340413719511654215,
# 		4763258931815816403, 6280052734341785344, -4979582628649810958, 2043464728020827976,
# 		-2678071570832690343, 4562580375758598164, 5495451168795427352, -7485059175264624713,
# 		553004618757816492, 6895160632757959823, -989748114590090637, 7139506338801360852,
# 		-672480814466784139, 5535668688139305547, 2430933853350256242, -3821430778991574732,
# 		-1063731997747047009, -3065878205254005442, 7632066283658143750, 6308328381617103346,
# 		3681878764086140361, 3289686137190109749, 6587997200611086848, 244714774258135476,
# 		-5143583659437639708, 8090302575944624335, 2945117363431356361, -8359047641006034763,
# 		3009039260312620700, -793344576772241777, 401084700045993341, -1968749590416080887,
# 		4707864159563588614, -3583123505891281857, -3240864324164777915, -5908273794572565703,
# 		-3719524458082857382, -5281400669679581926, 8118566580304798074, 3839261274019871296,
# 		7062410411742090847, -8481991033874568140, 6027994129690250817, -6725542042704711878,
# 		-2971981702428546974, -7854441788951256975, 8809096399316380241, 6492004350391900708,
# 		2462145737463489636, -8818543617934476634, -5070345602623085213, -8961586321599299868,
# 		-3758656652254704451, -8630661632476012791, 6764129236657751224, -709716318315418359,
# 		-3403028373052861600, -8838073512170985897, -3999237033416576341, -2920240395515973663,
# 		-2073249475545404416, 368107899140673753, -6108185202296464250, -6307735683270494757,
# 		4782583894627718279, 6718292300699989587, 8387085186914375220, 3387513132024756289,
# 		4654329375432538231, -292704475491394206, -3848998599978456535, 7623042350483453954,
# 		7725442901813263321, 9186225467561587250, -5132344747257272453, -6865740430362196008,
# 		2530936820058611833, 1636551876240043639, -3658707362519810009, 1452244145334316253,
# 		-7161729655835084979, -7943791770359481772, 9108481583171221009, -3200093350120725999,
# 		5007630032676973346, 2153168792952589781, 6720334534964750538, -3181825545719981703,
# 		3433922409283786309, 2285479922797300912, 3110614940896576130, -2856812446131932915,
# 		-3804580617188639299, 7163298419643543757, 4891138053923696990, 580618510277907015,
# 		1684034065251686769, 4429514767357295841, -8893025458299325803, -8103734041042601133,
# 		7177515271653460134, 4589042248470800257, -1530083407795771245, 143607045258444228,
# 		246994305896273627, -8356954712051676521, 6473547110565816071, 3092379936208876896,
# 		2058427839513754051, -4089587328327907870, 8785882556301281247, -3074039370013608197,
# 		-637529855400303673, 6137678347805511274, -7152924852417805802, 5708223427705576541,
# 		-3223714144396531304, 4358391411789012426, 325123008708389849, 6837621693887290924,
# 		4843721905315627004, -3212720814705499393, -3825019837890901156, 4602025990114250980,
# 		1044646352569048800, 9106614159853161675, -8394115921626182539, -4304087667751778808,
# 		2681532557646850893, 3681559472488511871, -3915372517896561773, -2889241648411946534,
# 		-6564663803938238204, -8060058171802589521, 581945337509520675, 3648778920718647903,
# 		-4799698790548231394, -7602572252857820065, 220828013409515943, -1072987336855386047,
# 		4287360518296753003, -4633371852008891965, 5513660857261085186, -2258542936462001533,
# 		-8744380348503999773, 8746140185685648781, 228500091334420247, 1356187007457302238,
# 		3019253992034194581, 3152601605678500003, -8793219284148773595, 5559581553696971176,
# 		4916432985369275664, -8559797105120221417, -5802598197927043732, 2868348622579915573,
# 		-7224052902810357288, -5894682518218493085, 2587672709781371173, -7706116723325376475,
# 		3092343956317362483, -5561119517847711700, 972445599196498113, -1558506600978816441,
# 		1708913533482282562, -2305554874185907314, -6005743014309462908, -6653329009633068701,
# 		-483583197311151195, 2488075924621352812, -4529369641467339140, -4663743555056261452,
# 		2997203966153298104, 1282559373026354493, 240113143146674385, 8665713329246516443,
# 		628141331766346752, -4651421219668005332, -7750560848702540400, 7596648026010355826,
# 		-3132152619100351065, 7834161864828164065, 7103445518877254909, 4390861237357459201,
# 		-4780718172614204074, -319889632007444440, 622261699494173647, -3186110786557562560,
# 		-8718967088789066690, -1948156510637662747, -8212195255998774408, -7028621931231314745,
# 		2623071828615234808, -4066058308780939700, -5484966924888173764, -6683604512778046238,
# 		-6756087640505506466, 5256026990536851868, 7841086888628396109, 6640857538655893162,
# 		-8021284697816458310, -7109857044414059830, -1689021141511844405, -4298087301956291063,
# 		-4077748265377282003, -998231156719803476, 2719520354384050532, 9132346697815513771,
# 		4332154495710163773, -2085582442760428892, 6994721091344268833, -2556143461985726874,
# 		-8567931991128098309, 59934747298466858, -3098398008776739403, -265597256199410390,
# 		2332206071942466437, -7522315324568406181, 3154897383618636503, -7585605855467168281,
# 		-6762850759087199275, 197309393502684135, -8579694182469508493, 2543179307861934850,
# 		4350769010207485119, -4468719947444108136, -7207776534213261296, -1224312577878317200,
# 		4287946071480840813, 8362686366770308971, 6486469209321732151, -5605644191012979782,
# 		-1669018511020473564, 4450022655153542367, -7618176296641240059, -3896357471549267421,
# 		-4596796223304447488, -6531150016257070659, -8982326463137525940, -4125325062227681798,
# 		-1306489741394045544, -8338554946557245229, 5329160409530630596, 7790979528857726136,
# 		4955070238059373407, -4304834761432101506, -6215295852904371179, 3007769226071157901,
# 		-6753025801236972788, 8928702772696731736, 7856187920214445904, -4748497451462800923,
# 		7900176660600710914, -7082800908938549136, -6797926979589575837, -6737316883512927978,
# 		4186670094382025798, 1883939007446035042, -414705992779907823, 3734134241178479257,
# 		4065968871360089196, 6953124200385847784, -7917685222115876751, -7585632937840318161,
# 		-5567246375906782599, -5256612402221608788, 3106378204088556331, -2894472214076325998,
# 		4565385105440252958, 1979884289539493806, -6891578849933910383, 3783206694208922581,
# 		8464961209802336085, 2843963751609577687, 3030678195484896323, -4429654462759003204,
# 		4459239494808162889, 402587895800087237, 8057891408711167515, 4541888170938985079,
# 		1042662272908816815, -3666068979732206850, 2647678726283249984, 2144477441549833761,
# 		-3417019821499388721, -2105601033380872185, 5916597177708541638, -8760774321402454447,
# 		8833658097025758785, 5970273481425315300, 563813119381731307, -6455022486202078793,
# 		1598828206250873866, -4016978389451217698, -2988328551145513985, -6071154634840136312,
# 		8469693267274066490, 125672920241807416, -3912292412830714870, -2559617104544284221,
# 		-486523741806024092, -4735332261862713930, 5923302823487327109, -9082480245771672572,
# 		-1808429243461201518, 7990420780896957397, 4317817392807076702, 3625184369705367340,
# 		-6482649271566653105, -3480272027152017464, -3225473396345736649, -368878695502291645,
# 		-3981164001421868007, -8522033136963788610, 7609280429197514109, 3020985755112334161,
# 		-2572049329799262942, 2635195723621160615, 5144520864246028816, -8188285521126945980,
# 		1567242097116389047, 8172389260191636581, -2885551685425483535, -7060359469858316883,
# 		-6480181133964513127, -7317004403633452381, 6011544915663598137, 5932255307352610768,
# 		2241128460406315459, -8327867140638080220, 3094483003111372717, 4583857460292963101,
# 		9079887171656594975, -384082854924064405, -3460631649611717935, 4225072055348026230,
# 		-7385151438465742745, 3801620336801580414, -399845416774701952, -7446754431269675473,
# 		7899055018877642622, 5421679761463003041, 5521102963086275121, -4975092593295409910,
# 		8735487530905098534, -7462844945281082830, -2080886987197029914, -1000715163927557685,
# 		-4253840471931071485, -5828896094657903328, 6424174453260338141, 359248545074932887,
# 		-5949720754023045210, -2426265837057637212, 3030918217665093212, -9077771202237461772,
# 		-3186796180789149575, 740416251634527158, -2142944401404840226, 6951781370868335478,
# 		399922722363687927, -8928469722407522623, -1378421100515597285, -8343051178220066766,
# 		-3030716356046100229, -8811767350470065420, 9026808440365124461, 6440783557497587732,
# 		4615674634722404292, 539897290441580544, 2096238225866883852, 8751955639408182687,
# 		-7316147128802486205, 7381039757301768559, 6157238513393239656, -1473377804940618233,
# 		8629571604380892756, 5280433031239081479, 7101611890139813254, 2479018537985767835,
# 		7169176924412769570, -1281305539061572506, -7865612307799218120, 2278447439451174845,
# 		3625338785743880657, 6477479539006708521, 8976185375579272206, -3712000482142939688,
# 		1326024180520890843, 7537449876596048829, 5464680203499696154, 3189671183162196045,
# 		6346751753565857109, -8982212049534145501, -6127578587196093755, -245039190118465649,
# 		-6320577374581628592, 7208698530190629697, 7276901792339343736, -7490986807540332668,
# 		4133292154170828382, 2918308698224194548, -7703910638917631350, -3929437324238184044,
# 		-4300543082831323144, -6344160503358350167, 5896236396443472108, -758328221503023383,
# 		-1894351639983151068, -307900319840287220, -6278469401177312761, -2171292963361310674,
# 		8382142935188824023, 9103922860780351547, 4152330101494654406,
# 	}
# )

# type rngSource struct {
# 	tap  int           // index into vec
# 	feed int           // index into vec
# 	vec  [rngLen]int64 // current feedback register
# }

# // seed rng x[n+1] = 48271 * x[n] mod (2**31 - 1)
# func seedrand(x int32) int32 {
# 	const (
# 		A = 48271
# 		Q = 44488
# 		R = 3399
# 	)

# 	hi := x / Q
# 	lo := x % Q
# 	x = A*lo - R*hi
# 	if x < 0 {
# 		x += int32max
# 	}
# 	return x
# }

# // Seed uses the provided seed value to initialize the generator to a deterministic state.
# func (rng *rngSource) Seed(seed int64) {
# 	rng.tap = 0
# 	rng.feed = rngLen - rngTap

# 	seed = seed % int32max
# 	if seed < 0 {
# 		seed += int32max
# 	}
# 	if seed == 0 {
# 		seed = 89482311
# 	}

# 	x := int32(seed)
# 	for i := -20; i < rngLen; i++ {
# 		x = seedrand(x)
# 		if i >= 0 {
# 			var u int64
# 			u = int64(x) << 40
# 			x = seedrand(x)
# 			u ^= int64(x) << 20
# 			x = seedrand(x)
# 			u ^= int64(x)
# 			u ^= rngCooked[i]
# 			rng.vec[i] = u
# 		}
# 	}
# }

# // Int63 returns a non-negative pseudo-random 63-bit integer as an int64.
# func (rng *rngSource) Int63() int64 {
# 	return int64(rng.Uint64() & rngMask)
# }

# // Uint64 returns a non-negative pseudo-random 64-bit integer as an uint64.
# func (rng *rngSource) Uint64() uint64 {
# 	rng.tap--
# 	if rng.tap < 0 {
# 		rng.tap += rngLen
# 	}

# 	rng.feed--
# 	if rng.feed < 0 {
# 		rng.feed += rngLen
# 	}

# 	x := rng.vec[rng.feed] + rng.vec[rng.tap]
# 	rng.vec[rng.feed] = x
# 	return uint64(x)
# }

# func main() {
# 	var rng rngSource
# 	rng.Seed(42)
# 	fmt.Printf("%d, ", rng.vec)

# }


class LFGTestCase(unittest.TestCase):
    def test_correct(self):
        state = [-204604804849473497, 4978660247881509547, 7815724132203751755, -1925831237928058062, -1981311040946414386, -7140159485058386757, -6123016579623331044, -7995689788223287924, 7322098695133591315, 2787122079326112408, 1839971287024973278, -1465251644838025873, 527832092453699788, -3268878381899512229, -1255947932907140519, 5214393252761917383, 7583068718227409249, -3173594952576496759, 1245490180406585679, -4738528016440758119, -8930746249734895326, 3164280773886937396, 4663565261362889260, -6972002470473532310, 905639821494766829, -7439125889359395778, -4384822465266552129, 4455164259723008512, -3230791136645190029, -2849642045827823992, 3412712313341265347, -1047913716506691216, -3465952664886306133, 6309429205281426200, 8358699920983350383, 8113767813491909572, 4932968049958798741, -5862296346432449464, -328443323435795001, -601974184904471835, -2801233566025474221, 823713756876340210, -7786980043126907181, -3882535285752217107, -4239574072251955298, -1638920026015551026, 7475651390861770571, 5528986280010045452, -7351470944620250376, -8600573953964896940, 2096855144365486944, 866192246906858280, 770656068107680919, -2275609345521118022, 3161757106244110413, -2286589746549225441, -476361587536012671, -7033604822030745366, -2747921504682526521, -7694598386623802867, 4324247180956790886, 8282323225176360427, -8086741904163458515, -890398742689181817, -8650957658803426727, -875088012412921929, -6024398687400489353, -3003413192646676469, 1166802354943763017, -6693307757636074233, 1323063507231073646, -1206870141323334539, -2864830444795042173, -3990844877617078912, -7393004750986757305, 8540156361145638807, 3535965358769565681, 2127973277573759651, -7021306788518901384, 7961263479163791217, -1599870565434199175, 2352768477499386938, 7794806212170507292, -1598381530247384348, 1128649454063897179, 1347950790171517360, 8799799933772386819, 5893311712950650819, -4744159518377814179, 8978889111995726351, 4946416085741332775, 5030747463594540228, -5257034511704727250, -5685524613614056836, 8217448344785317905, 8399019415599348263, 350927997719605731, -3664007764707252513, 8049321590664538547, -7971743359489959112, -2835106691842895965, -7976769220126712553, -2259554580185519728, -2766396207885548866, -5347819781079082144, -9208366710561810536, 5232405779865848470, -5428502473305567029, -1281122153980705597, 982534037794925283, -2823211634206833993, -3503230580419084839, 3235332184963606641, -5972343185240818646, -4797442835773989596, 4718214379848231962, -6320873533751894677, -7916873905629005156, 5180658203987163786, 4070167728318039592, 2586729850002137956, -8631944176943049084, 3571950456552503482, 1562127531299600440, 1602448300492577664, 3468922126532323189, 1315822976028226432, -5254926472150697619, -6977282208953987160, 9049821756893835601, -8656601813375788285, 1075959087276726722, -2398279244744939608, 9052467513470518734, -6226627950193600941, -8397921405721886706, -7944985629142064227, -8678494162225390949, -8845991378435639871, 8079712579332682794, 8239244115664915045, 6574659059447700546, -3162679863108244466, 2523819888847168928, 3096501894890847261, -2305680602246361351, -4557361182526683092, -6958744249684800373, 349873025075979912, -6129230994638490333, -866822427222592472, 4170691980427706851, 3001706687016841562, -439118662853757940, 7572689498148605957, -2381652704322572766, -2504004881557898126, -7388544715570809561, 647731417277169646, 4265596798202530857, 4050537521827927489, -1925722207938427652, -3655056993956334621, 5882206836772961630, 3443455011104109829, 5975233207190489146, -684673683985727111, -6827402077283298235, -1757200353235739139, -1871609406106345314, -1169020870359979374, -1517759890242206860, 5836584236044442238, 6963317984140402277, -684721928337927888, -3050412167001373851, -6187751535489211996, -2941233290637088080, -1041631586165485024, 1626137708982023414, 6174294962656343433, 130420916876439808, 5576566108014297223, 6436260517944183105, -6881040722272389283, 6282444582249019265, -8542983302631186574, 2650418989258681084, -8076966850044538185, 3408554454648760716, 6691315431064913212, -3069351422988625803, 3231064916171043827, 3911860846388851269, -6955949697137545693, -2465146120881942269, 2026145330164851500, 7753377821637619822, 3004115090050795641, -5141812723308142445, 4470360204088402931, 6341454661755501214, -8289628364991453017, 5610954569586628951, -1265540852851453976, -4237480482052655150, 9076010553183206654, -446719483930663747, -5249180128285624513, 1536879141525934192, 4424808457292672829, 2527295502175122508, -1254028603351560878, 5770019955602522425, 1454736709196953773, -8942424269569532150, -6421720570227983184, 652728144219789612, -1608888203645403121, 5948135325970198556, 300924619788167956, 2105703216207901569, 9215293876255507176, 2042408158936910682, 583281041254407723, -8140578692695415135, 5339770307243492668, -5661599157731082175, -3898870091879534176, 9132933745070261267, -1415939234315681018, -7224774643541540478, 8892415088478238183, 6601362185959160683, 3877005134816041977, 2622607645447211143, -8714600099208131422, 8642348484905217517, 5638721587768302758, 677691318190229286, -1314887752721512909, -9004772933623816842, 2448301762417949333, 500344565188309072, 382360533177701313, -7778342291776560649, -8809248368932673849, 671040993940428012, -8955358154101522241, -5071514587522106286, 7507616690062827660, 5414895220996327603, -4201600144052647898, 323428046881750322, -543018456420072875, -6289190617897907112, -3144141317201207217, -6769569959448912372, 7350354663384462725, 5990863285084177574, -2604818392968340091, -5884011401262814429, 7601154748289808589, -3179735998004144248, 1677687726562403497, 4379911760952510342, 8893902018602461589, -6310321656669229581, 1759958555044318885, -2439182430155662968, -3304169736143868253, 3484765519441631727, 8825947601237282714, 7765303820965892600, -4441001609234600452, -8960692152661705704, 838570815485486970, 7074448711366870493, 7938562253942249107, -5516430282064330608, -4620452410050290906, -5861682507957306210, -2139036688776781651, 8267185653461398706, -454406576707454667, -8366273223570312770, -5080328751954418523, -1517038000322285800, -6002461307435949894, -5009244407785689391, -2963581282054596667, 3433517555950600114, 8527692288482558217, -1026809469465914915, -9127123175084321672, 6825268720391837019, 8472202260365442090, -7259415130521311747, -1305759519742598501, 2266332505169667426, -6198293085269249928, 8815246100004802983, 279957429078078027, 6061825796315929489, -7760280916848231877, -7867467148158697079, -7829404999656649177, -331923761379697768, -4987561650824677275, -3150658307868498642, 7989785544943785447, 8382709085037766548, -3063383913563007004, -8970983469726080073, -5068240257867391734, 5014431715183748064, 770528457503882170, -2451867654312446487, 6853639525002624270, 4307502341263515806, -3871538222526314921, -3864579331370368720, -7204750594759092366, 2472472068191613017, -7737753338280328481, 856525812293452100, -8446309148075659141, 2912263862289182240, 6713654209430723633, -4075357872110524160, -4791180927305803349, -1788107665950712192, 8264414914175363828, -7051849183823734470, -5082233682192162571, 4172198913005215908, -6774845080706608240, 7081030057573743358, -6526376737570708032, 4693413533751785907, -5884389046388398187, -8921563651111006907, -5171658157217536483, -8832421546134305086, 1404922017194980073, -3112930617281559436, 3539238430735052029, -5164692167507378794, -5206340938608046446, 3006183824307186136, 8846016493086029119, -496140448453136827, 8916313007702183788, 4454438797780439291, -2575514318304314252, -2963202884734649960, -3145449519501008398, 7841194704690278624, -4363535669667149263, 182756231757463001, -7209330062632477081, -4937915123602103678, 8325797136163719663, -6505613040022155178, -2918607383628135186, -1016510059557108661, 1192234187013700931, 2269223162996079676, 1374629160329725597, -4334402381312479295, 4716198764898515109, -7487524474158253461, -467176748836242697, 6099387306221814913, 6478133389641815292, 1526278903679695843, -2739987977604513419, 7490188444371563661, -8877973363017840711, 6375998953376926599, -5668415254656662265, -4988250164711525959, -7446854535724407626, 2563854497372018855, -6860684733512136625, 641531747073433148, 8527387820989670438, 6668260988707504617, -3086210127963102023, 3530853843568675067, -2694474371585050952, -3707406091958328381, 7997682129645602401, 2816302077378831306, 8200739122734489044, -8551710191613889850, 4575234608288423278, -1899853384520179854, -6199882830065940672, 8799453482822324917, -7836874702302043554, 6430883546002809138, 7040905939612384242, -2757209521240521268, -8376046457059000020, 7772538023352803198, 368796100842024033, -182710284015411390, 2858590450576694880, 1492293994997522110, 8513730317529441756, 4140812525840962318, 3846369064800549714, -6136315887777780506, -4614931794306469436, 4420976185471130820, -836952423093802098, 6643224941922636446, 3382291579181401238, 3685007562930657555, -1067684526099212540, 7847869447808195563, 203572724069967541, 6304399289111314392, -1273787448749250434, -1934816825512161225, -2033801437451962884, 516304439991366477, -1917174612112826693, -4385903313617163114, -7219267140267946021, -2560398713910110033, -6750637862855271555, -5517578859349233211, 7162160996641315379, -7167295695119880423, -2964812341899847130, -7819571600092320250, 8873637856849611357, -1259765807663048888, 1984156201370044706, -2779115033248811003, 1061771992177423369, -4640454062318227804, 472199340531854479, 7800732440580369180, 6939661476564250297, -7965225614729910769, 1862554673540242768, -8382161417460193463, 5987475107506212769, -2293278843926946045, -7831582118891392682, 7322941337502469493, -7887836934963181101, -1666208080602415320, -7058945127024351504, 7915532506155867578, -8227647662860090395, 7113530248223804971, 3836974469754137367, -1723069700581333617, 6048280198407563191, -2844629921290551952, -909637400117742697, 3072328541307616462, 2138013015221989584, 8382917531917522350, -9196886547453130069, -587296657004883811, -5546233216335364304, 538922349281605662, -4750891456907211857, -2152080386968411951, -5013915426319498242, 3508148137943463509, 8698188137642409938, 618695957576882322, 5262619785569011761, 4115815722331280686, -8184061974362245123, 5167678412612535116, 453497968339538545, -7315841134943288182, -3419542908705007154, 2025559015622619682, 5129839793551014962, -2909997338808504246, 737613870711396510, -2788637527791249121, 2348119883256983501, -791315483304350692, -7565055086814592647, 2015292915928617669, 8528594093888459771, -3189604947073756014, -7855209505816636776, -3919819171420449220, -3475230003353298213, -2304872940574138551, -7901033249957574850, 3140044591014083712, 8573413589427682541, -6524169351583960812, 1171018583893361660, 165273673111215586, 2748727527407739735, -7758135349176024648, -8031757281620002649, 8272371916981057783, -5595266153022616854, 8464592942712296327, 5526309326064457522, -6100665946765634967, -1578029338817630401, 6716068378364125212, -7202155120983750631, -2282232915355286550, 529352476392398396, 1027385667512016566, -2341872229714693854, -2971085023010720825, 9160397096453860059, 8491167443580173905, 6326109394296656073, -5354173691785700366, -1110072819330503430, 8606748115184708657, -7725120132025451071, -5170837473265638174, 1681710700672366518, -2361752275800158747, 9115578345470231069, 1593303941413452113, -8377944729727169085, 8065956667628785125, 5511772528387539231, -2906477322732016018, 3901442817725158294, -3564948282915817134, -96224010939306324, 990701261505646764, 2998528974313225625, -8459064676928423608, 7284242461869236757, 6714488869589602045, 662497920838608390, 6829286412268558325, 98010554226915487, 1790187118131614928, 6328999980277210560, -5781306366576098563, -8015913117227399524, -6508711106004345148, 5292279201686967123, 3767866067802118533, 2680349374482246536, 7731296305318425972, -4944495571442822055, -8352747384175266309, 9214960260322263624, 2053470223125828005, 2283511652996955395, 3487898694641700859, -1079558403842283496, 7668169974291648345, -1341673492723423939, -3534314952715191457, 3796186349227798008, -578061956729693682, -2547426810356567853, 1061155337262993902, 7605320303779787393, 6173592565522998166, 8641063345377015714, -2846709537935129053, -2673663610580875208, -8739431304633028698, -6421763583820944301, 9028091371275406837, 8880038265537859793, -3848632562744424324, 9169481784270887120, -5894952718669976172, 3483981009605977433, 6200870124832170102, -8375119046605219530, 4798739032872625425, 3670952233029118695, -3390832370647872536, 9022283080155211562, 6669701955823021582, -7406454371079551072, 4989762285366585702, -2022858039338192098, -8465217486784401, 4312510806751888297, 4476150858887316857, -6546934507342735040, 2768824213283497541, 4585204382594331007, -3179319842216486372, -4743860219000703991, 6717193513832427358, 7359890004052590952, 1567704259223268391, 1269056501200237337]

        expected_output = [12663951391086054483, 9832119173398632219, 5571782338101878760, 1926012586526624009, 9627525982598323465, 3534334367214237261, 7497468244883513247, 12769259138917390016, 12756335378660268676, 15185141594316539992, 6784982874943501314, 11233528261463674849, 12559306703000990798, 1118224062840270781, 15347792043893516350, 13523341480825645852, 6570415425842765075, 15826440160565561250, 8685383948212866759, 18177242848714785307, 1100641557378252013, 3137486211269163098, 11866690094643743981, 2094832826273809275, 6018823476402388478, 9610549860140450017, 8548114504158162025, 1198686371618757660, 4157513341729910236, 1947031852228291041, 3388162185735054281, 15879991964852500590, 17456309445381818697, 18422043553963299854, 9871652808949454819, 18202139891229947017, 8639902132831672016, 7894140303635748408, 10621455069619635027, 5785305945910038487, 16078261111520212762, 16195862262774206562, 2353959152108316618, 524317412587104192, 15721011318920817620, 14497752989399429727, 7697922259999977824, 5013667937579866784, 5135975278696416791, 7276889728610971305, 10947535027943645242, 1628829379025336882, 17877340767439212529, 7317580557654915562, 4914400674417821484, 2157255887366150544, 13403448691644081053, 2628757933617101898, 9584062475274761399, 2388284803033957873, 8427801741804500990, 15540436470826884759, 10769007981310868484, 6683509660637259755, 559346544157562657, 2750659816549965649, 12040198406101015711, 5328953735686644455, 8281354578677668636, 17217954477539939095, 2332036530383394983, 15667111415918593714, 4184787942719568102, 17435229622154663638, 15106441630554408643, 4988602387584303978, 13358884814933005762, 10131765283242706225, 4432433323786193433, 8063729658764635782, 17660099301260798508, 8890970237871203352, 11741004615292983676, 15998784133643001565, 4088882508931753773, 6520300896597308550, 16775912837935285774, 10664881372288894333, 11197754258325389363, 16546871691531966379, 11744933517914110057, 9164370140782074545, 7863941801268104373, 11031190374222403740, 6204000644254686808, 14103314530480599085, 3047082331882600663, 18004515891482477977, 13037594437536760110, 14565613859349568945, 9350089713366900418, 9057688761589453769, 12392988014061372798, 10506635487809909786, 17706347334497943808, 17687918572844101152, 4884111666020894591, 3034897366669354117, 6830935377660838268, 15110205943543510119, 12633942726829825522, 6025688929181751162, 10634297310096361340, 2316217535716785625, 16829824312865157525, 16046540386759797803, 3000848027476773113, 9236385975690319311, 10241933674851415976, 16991483444098001143, 10899859749153537387, 771530412271058804, 17554496667179666970, 15555711396058936263, 1990377109865472737, 18365242358036462219, 9815962615416642746, 13191826275514487340, 1025139303516356611, 17799899178434979962, 14309142707229038889, 13665263846661562108, 1327539235436002972, 2318279817119990980, 8554039893494197314, 3543037439332401303, 2207144605302255518, 1438848673159967689, 6784711405374479278, 1426967834779976657, 6049873861610840853, 6303393457478660289, 14467755250603183116, 3846685509774361260, 9456834653056323907, 8646707523083679814, 6487393459012818451, 17017291019302170013, 16501540993098480486, 1034491783883478295, 17824059464629383217, 3910358027411881903, 10689328055622810323, 13497236300158812926, 12241299663800182348, 15111833643617120547, 3046241816869124689, 3876831120760146157, 17258886580248420533, 9796796530641712959, 13902979460704652574, 13637316676624811418, 17401183523999199235, 12637269141031344438, 17636906659780629671, 13910428687225001474, 13603498197796298087, 16502304582060775617, 14848871064040100503, 14070627484721341195, 2917394494873114500, 7624391384633336572, 5236438788702887727, 16979702736188245894, 15961703009056810918, 16534076777076611229, 3838932217870796034, 11556835878534490376, 14147916757274152157, 8088993938139972434, 15973823973403830792, 1066889861504680337, 2896904531678456417, 5437576861888721920, 12521085803141028824, 8197742472884175475, 10420315297925538703, 17574390454113526079, 1076610976935039887, 9739726836813483707, 1686867465753366830, 1258296322362886354, 1959727265141231110, 2102928227887134539, 11926081644133232508, 13741565221114874063, 18281980229013602423, 11994052439565009499, 12907413118564359790, 12037405839500539285, 9421263614312542767, 5374258778607863590, 11146656703927278318, 7032932739093242063, 16090727696506219843, 17900345410758373594, 5354942899256810443, 10115276458850551349, 15715783370175934133, 18149338989681949426, 6137362139588023718, 13466984338648165248, 18015539019500991576, 5403031927380969262, 12067849857963641993, 1473252112028835405, 7835395796495495508, 15656724383526332006, 1632004251885129939, 1870818152933515021, 2555044635748851792, 3876863932037039789, 8082828759778330152, 18187386936874736478, 11982423575780069273, 12177371755017320060, 7349826345747322322, 11608404733242775069, 360404000129900369, 2142368663292481517, 12940359888219489331, 17713468397203727731, 16948108243224654355, 3264280614378918948, 10007823965383349807, 561797116506285086, 1052191000191262596, 14463269690116678052, 9773648575929073860, 10486671507781397581, 13953453647109195711, 12173199502447715705, 2112140079966405042, 16887547119428729213, 17304686248159446014, 8764669431729633759, 17130725724027725354, 8982556165529849820, 15431159194213919713, 8969844158754175803, 13702913023961158870, 4831603327435857332, 18223998232904624302, 2854568232346240116, 16877576486865975005, 10929296836737513405, 10973989770659788770, 6542149183076751817, 3333815422537592361, 5889047155215415517, 17995137626827524733, 12468983011632950007, 198051875871645534, 10937386034806320176, 6581778158855940900, 10691982777542307726, 9558941834674476960, 17115758920060848170, 11045279323725921655, 16876816472479868247, 10781500250313761559, 14532201082551309009, 3200089542984197856, 16988198572042845369, 2137520786774829352, 2823860833419352239, 13339151838205430259, 9151164395062310794, 1247744620665011820, 10659225351127623660, 10493649793396271994, 13526991446767949595, 16051333841223398272, 8881838019308988258, 2632954307498777909, 5207835758380740422, 6647210342850316233, 4376699361045735305, 11884421454810094826, 2330841353590809777, 11943904874813344143, 898403905085959578, 554212531881573901, 16746152065062329408, 2535512026364691263, 11538246771207948980, 14679280553550911427, 10951791526361187219, 17724317673632359589, 16906814425141512408, 7508115576900183860, 691560676843604103, 899118135721599825, 6800874499076319628, 13030349919024676598, 14225518308736628668, 4430463739976756750, 5486830343682902690, 10763014001870551239, 9545541954326438845, 922137833162216098, 15285020330982524287, 8949586719796975883, 7147514861785317436, 11457334246333448443, 3599449332514902297, 15797466533720159049, 4857335963438675253, 1265402168451795494, 6441974327092837305, 1744789555680354555, 5663807371150116579, 5811638083772945432, 12787506314968618520, 4415951458351449290, 6752695388863252228, 17768634843141179254, 17238128168504042056, 13463840476017315403, 11422137650697666667, 702926695689043836, 17399786607478513154, 7366945050915467420, 8223196936955027493, 16809492972027122096, 12336712240534136875, 14043399664689850707, 7276540057989990015, 16453543671258813274, 8860878563884529339, 9914158118280975462, 11050178791961166177, 10671019970197204055, 6808187389270711840, 1532878148960930395, 4176322725232783701, 15412371582816471540, 1649459842211442729, 16028892090214304522, 1581842697046475728, 707304289688366171, 1041600953138320897, 11734681891793754477, 4012094260423872317, 515851191265983822, 17941874740125153778, 1036021069539427382, 16640673863971329217, 15689782680868195670, 12927280275190861450, 1098175564117202510, 1779101555891244584, 10125108107711022078, 3005502213281081359, 6490706530201199337, 5017232263332975320, 1225509645889867838, 12377593209777684974, 3261890760550834862, 4108237669145594565, 15457089081125910124, 12459532480807066428, 18361800208577366953, 5815774760651708961, 7716015268866029830, 1614413914643469527, 9427077083967626290, 2747501955430093051, 1524686152131504931, 6937581889146722596, 12249857626991617741, 16924932067195123575, 10165710372100688064, 1918494958438699878, 8706038303663997698, 14402163377898479873, 7608496737403752748, 10321113206860812377, 8030627269532398279, 15666285734610226166, 15565385955967529871, 12032120792983030904, 17089493998324916630, 17729146161422095712, 1434028333109667194, 5822241463059717399, 4393209784218621404, 11978056506646600745, 2917027258640136228, 10806663876922289510, 13095602264575181016, 15906935094310091093, 3254597922450586640, 11402665384497022871, 730292301339549723, 9393495903064788097, 12387079161102373511, 10147343834907649427, 12658615784802632372, 18292136403211648387, 3120559373832334207, 1613873932108841104, 12148591776464077202, 14656621976795549510, 5193320638148156859, 9113581558817482750, 10172794904071017333, 17948002096636497812, 17807104619537539873, 3516308436002097626, 14675418789587476159, 17528926660610497052, 1563844260275876691, 15541826549274096667, 15154946980137682888, 17405396433986935535, 11919206961341182525, 6140633717034547381, 2191398895972026453, 11510834759581421016, 16728309041447080919, 7084514423519926700, 1765039249021710310, 6144844111528627926, 16386044204032551153, 17566457197110414821, 13808287724924706098, 11112737308196668859, 4037098202943132399, 16743542788810381799, 8601271332103200767, 12543998123465961952, 10595397481368042982, 17444319397162216896, 18215925952526251412, 2046833841629131713, 7061552756367154049, 17976995924985428587, 8969021690262018582, 3047616734566445342, 13904955761791473877, 11359279229482903036, 8826607808851368944, 13063826634595326546, 6196729655055695299, 4922463547301076099, 2018033953183714766, 5205244668197740642, 8651240441223714020, 15587993710538073819, 9390328479751280956, 5192426699266320573, 15002346622382495468, 2305563423330249152, 9956484460005296292, 5467875403084694619, 15535756875277187913, 9774001257164820557, 8990673764207662206, 374158504585656469, 6447819223229645195, 12320116461559475979, 2840519292047409216, 17804181146230065117, 7512271793829853174, 14218985245234894780, 6123295338975499366, 13246097775215667891, 5501881535456385169, 3631873198675476826, 13952250928604688716, 4382569544690187488, 9921691326821859031, 14052894645743891296, 6408039211623813744, 16349330938898576256, 15961939066127339777, 944047121756559870, 12088414066846994339, 5542116952568549463, 3197455417322993159, 11696586908134488092, 3733372826473757789, 13036563094728492639, 10816525408601290086, 15883561200358699332, 212842203697039341, 7341969513461841469, 13239143747194743429, 4570711312498511319]

        lfg = PRNG.GO[LFG](state)

        self.assertEqual([lfg.generate() for _ in range(500)], expected_output)


    def test_csharp(self):
        output = [310326440, 771643343, 1072142827, 627288249, 468879884, 268490028, 1631864866, 1371482775, 1557267296, 1695426478, 1662989456, 2113284138, 2055927876, 1775072825, 266397325, 1516865843, 783137533, 1993301804, 179338820, 1476833818, 1825599657, 1211654914, 299345942, 1065961935, 1098226457, 322314387, 2077684678, 857103380, 132115346, 2043966935, 1122128945, 107674160, 399854501, 371607545, 877848575, 56971811, 1595121377, 1191937828, 193507287, 2141913432, 154205052, 507072084, 242970022, 1154970386, 1022240510, 760912194, 2124484006, 201055680, 1554083882, 1296477385, 761675667, 248681338, 1390656680, 1611467725, 1100472019, 1246155173, 472297401, 6180892, 1676545439, 146565497, 338288997, 774761486, 1239367429, 1660784008, 573297533, 1555315296, 1713429637, 1684320331, 897224250, 209425514, 2069228113, 1738683352, 1799794517, 184909035, 1322628766, 1318527573, 968684892, 1291859203, 43721425, 337314263, 345314028, 1876628998, 1450503145, 983121608, 1282291268, 873447607, 864501127, 935870423, 1418619173, 1779177049, 1732158057, 1588940485, 1662876036, 46941790, 1803624435, 1526927213, 1415188302, 729669661, 581672853, 1614408861, 1194966204, 440163675, 1451315077, 1344658368, 1374732919, 1170475962, 596370468, 1205747645, 288838959, 1929428093]

        lfg = PRNG.C_SHARP[LFG]([0]*55).crack(output[:60], 3)

        self.assertEqual([lfg.generate() for _ in range(len(output)-60)], output[60:])



    def test_crack(self):
        for i in range(5000):
            # Fuzz some variables into existence
            length = max(next_prime(Bytes.random(2).int() % 1000), 5)
            tap_dist = min(next_prime(length // 2), length-1)

            feed = Bytes.random(2).int() % length
            tap = (feed - tap_dist) % length
            operation = LFG.ADD_OP if i % 2 else LFG.SUB_OP
            increment = ((i % 4) // 2)

            # Set up the LFGs
            lfg = LFG(state=[Bytes.random(8).int() for _ in range(length)], tap=tap, feed=feed, operation=operation, increment=increment)

            num_samples = length + max(1, Bytes.random(1).int() % 50)

            cracked_lfg = LFG(state=[0], tap=tap, feed=feed, operation=operation, increment=increment, length=length)
            cracked_lfg = cracked_lfg.crack([lfg.generate() for _ in range(num_samples)])

            # Prove they will always be equivalent by generating a number of values greater than twice the LFG length. This guarantees that 1) the entire state has been modified, and 2) the modified state also produces an equivalent modified state.
            predicted_values = [cracked_lfg.generate() for _ in range(2000)]
            real_values = [lfg.generate() for _ in range(2000)]

            self.assertEqual(predicted_values, real_values)
