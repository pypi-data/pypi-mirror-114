from samson.prngs.mwc1616 import MWC1616
from samson.utilities.bytes import Bytes
import unittest

# Test vector manually generated from http://www.helsbreth.org/random/rng_mwc1616.html
class MWC1616TestCase(unittest.TestCase):
    def test_mwc(self):
        a = 18000
        b = 30903
        seed = (1, 2)

        expected_result = [1179709806, 3640665506, 3813623974, 3729379433, 2872989008, 3027099254, 1595440788, 2030978226, 3263088366, 1553982598, 2702936471, 3554709171, 2722048726, 669069892, 685826767, 284443052, 259718375, 919089176, 3535804521, 1795932605, 2941395357, 1392966294, 3322380563, 3808273086, 1400087215, 3293093846, 493608624, 2841246510, 1239713507, 2646821558, 3007051701, 1338248605, 3061499913, 2013805786, 3835563561, 3327620097, 66743140, 3499809583, 1295509820, 1685799230, 497361229, 2099840207, 1525974957, 1184896751, 3942362323, 601193893, 2971302513, 2113387014, 399770630, 2363033602, 1616620372, 622845138, 774347495, 543320897, 4149046402, 1593095041, 2821520481, 2949920251, 410039663, 1934349261, 2418464024, 2408249351, 3199727996, 3399281816, 757192268, 1475756004, 3443912969, 465085327, 836855009, 602792439, 365133602, 684604379, 442150272, 3814007481, 1338825743, 4130367256, 619338220, 3367901265, 3112404046, 34746169, 3298080802, 3872499346, 2102253873, 1970636946, 3573184200, 174254430, 1159666228, 378177847, 3659328172, 3606094247, 115819785, 2369379753, 3115699292, 2908331593, 3033644684, 3605799095, 3815343275, 30870954, 2611393301, 140632692, 1326486877, 390973507, 1808258643, 513178563, 2960803189, 2324084991, 509142793, 2978789034, 3423973495, 3042132787, 2482848939, 2665307629, 1001741516, 1379017246, 1812373300, 2087927362, 1939586112, 2761862939, 3307220241, 2268496313, 990152831, 2925746164, 2703589321, 2843064872, 517082841, 1009495271, 2548557857, 2998319390, 3331903975, 3499469675, 588977271, 2478488038, 264551696, 2916351512, 138689614, 1560159123, 2242212485, 4212803033, 3100957727, 4281795352, 4260617716, 336071393, 3091244928, 427868577, 714813714, 3111247660, 3842195351, 2514396717, 3360030759, 3809063485, 2681274797, 1437310647, 3008707995, 1612184740, 2188482120, 3283395737, 2215880764, 2914037889, 2336682891, 3650392983, 2625682376, 599933328, 1671214716, 3532829070, 3573273230, 1782933307, 1309660790, 2615201543, 191933217, 1573924406, 874817868, 1023720222, 932323910, 1516415046, 434317875, 1103323598, 3859582504, 1037012150, 702490914, 548051368, 3164646013, 3136864207, 1900967261, 4021999597, 3846089154, 3644305279, 707152853, 3414777860, 476292766, 685201464, 2499583641, 2180464888, 1344011281, 2384611017, 3433056395, 3641255102, 2164487687, 1586280532, 4147076019, 849857504, 3256150109, 740889245, 941511629, 3380676690, 1304005154, 388543034, 1104795800, 4029442226, 668314976, 4068942078, 3206608723, 3164390371, 3443450852, 1261249626, 74422220, 3512087544, 4028083676, 2326692037, 743552718, 627538426, 3864836073, 788916499, 1322638157, 3984214514, 2814817127, 3541674367, 4226025057, 1228560196, 55526558, 3066906136, 788036483, 2947929010, 1937178235, 2300769727, 1180085128, 2760561177, 980498625, 1451322633, 1583170610, 47342376, 1737212352, 1580642049, 1364258067, 1658893082, 1012246368, 867760660, 2316464952, 533992180, 271327937, 511596775, 4291945860, 531569479, 116601851, 2795822410, 3978885224, 977582768, 241395954, 2700201222, 893620422, 589606455, 3789657493, 636884905, 1592420440, 2945311248, 2216774307, 2156342558, 947549092, 627941250, 2408787061, 439872218, 1654597324, 1390660242, 335958185, 4238622804, 3502211605, 3138646872, 3779424574, 1995535889, 1328518029, 3109800311, 3828289956, 1536744252, 1848434741, 2397603139, 918688926, 1340083145, 1158327912, 1695576550, 133598631, 3701653526, 1087365765, 390700966, 1318935162, 2239047806, 3358010556, 1524051324, 1680455868, 2613265366, 443688214, 2590569143, 3083033165, 3914864510, 771229095, 1838636405, 2513480013, 3474541084, 3069536729, 1668384017, 730876176, 407959855, 2230799116, 501070612, 3885317807, 616771408, 244019135, 2542370776, 3570325529, 4261309991, 231893959, 56854322, 616318864, 3819890608, 3296084110, 3882361538, 4134922015, 1109315468, 554789391, 226048663, 1424350196, 692303628, 1312940363, 1168476909, 4144943527, 461400035, 3688566305, 2650653332, 3379723893, 1258592611, 3230943590, 3134885950, 889474798, 3700572198, 3895447650, 2772698189, 2097515854, 2633274569, 3868644944, 1039923544, 1069933302, 3700818797, 73659889, 2911291620, 3742691060, 1575522086, 96834775, 3311104305, 2416257078, 2512667642, 2362366636, 2105676033, 3947628244, 1916291473, 1109430751, 2304766233, 4191770023, 2408248337, 3686766730, 219950524, 4246411602, 2114559791, 508878473, 2497615614, 1102342273, 3911414634, 2130403853, 2423809463, 408988685, 95307073, 1628588696, 1127199568, 4082749788, 1950555473, 3922087840, 1372518707, 613757184, 1124629634, 747374601, 1177104677, 789347645, 251999687, 477951055, 3537946068, 768753087, 4153084114, 1778768700, 3280854028, 3341702132, 135645999, 2068147759, 1707617128, 2690382669, 442814594, 3276501869, 2427452733, 1179899144, 3551363105, 2271245323, 3357759560, 1109266992, 341354993, 2108259290, 2154170616, 644080559, 875875923, 2462830769, 1875281873, 976318671, 3020155908, 585878541, 1558275221, 2514951867, 464703259, 2093793994, 3478867982, 3501598172, 903042564, 3175313078, 2243468457, 1299933443, 4247438084, 2926016864, 4021821333, 1768334527, 364338029, 4028874906, 2732984626, 232021392, 1996383814, 2804684840, 1718498514, 1145716098, 2940338390, 3814786555, 3295866578, 3457362671, 3454282102, 3889760153, 39598572, 611191625, 1996907647, 3756090395, 2634049200, 1300043524, 2419033160, 4260911698, 1427717886, 3012641321, 3668943107, 1644273751, 576762397, 418068054, 350321527, 321397680, 4064034056, 537031052, 3475564507, 3041565463, 470094533, 1364921333, 1445096701, 1291355774, 4113065846, 2711848133, 1480946076, 2683671839, 315512507, 1615851006, 3084540279, 714288202, 2993652502, 677452188, 1431481428, 548903967, 1520399211, 3568104219, 2527307449, 3747174625, 1261391733, 2517159564, 656829323, 3373623746, 2672868452, 3761945946, 434234411, 3655769094, 50054113, 3427387241, 3449888876, 2154507068, 2615809838, 3630511685, 1751264833, 2786042382, 458980817, 2618045649, 323220667, 2177675924, 1560967986, 4073116915, 460151756, 2730402622, 3605589147, 3308394438, 2259041820, 2919862586, 4257947071, 20713476, 276127971, 585609682, 381008589, 2686907492, 1981606801, 3166490596, 2201021200, 1389816439, 2330513896, 4013964135, 1780883868, 3516285575, 2684872282, 633403828, 2012499018, 1050586789, 3864155116, 1993535502, 3437384084, 4081197566, 1223000842, 2824891437, 4060457461, 768510245, 3873026455, 2254764956, 2527547457, 3810086172, 4147143900, 2640272800, 1804868847, 1098507007, 2841434605, 649808756, 1794422447, 786678445, 3595605967, 3856722117, 1356596328, 2883802139, 3743795553, 147166207, 3638211134, 1653129243, 906973017, 432065333, 2597929037, 3236064989, 1026029133, 4213857617, 166404363, 2691494622, 2893659206, 668981391, 2668572416, 3651403550, 3231679643, 3883330329, 3452372326, 4156693190, 2971989526, 2001487449, 1080522153, 1794405627, 904953576, 2556473089, 3973107086, 182047495, 4208689902, 1231719332, 839315449, 1510638807, 3973918425, 2345300931, 741228156, 2294612282, 2813472237, 959507711, 755959792, 1046846545, 703642021, 3424868008, 1752435106, 2488400811, 2617250759, 3904692717, 1301848510, 258742618, 1863359387, 423423937, 1765876822, 2973678216, 1950885978, 925786187, 4065333412, 2821190308, 2025675540, 2537549238, 2665048076, 593129643, 3552699213, 4228237611, 1505255659, 2662911705, 35963602, 2933396903, 3021348415, 2061840703, 923191884, 4154545036, 2003613816, 499336493, 3216892455, 2705068671, 4285082477, 3004705700, 3450218166, 3641708718, 1836813987, 336488034, 913466192, 891465335, 4120161765, 1155004663, 2426606224, 3621272150, 2872642619, 1394114991, 3062350301, 184707617, 784511233, 2879795650, 347591973, 2991967465, 4265613072, 620387600, 804589904, 79170578, 3601602824, 520858217, 4033221852, 208034207, 99066495, 93903627, 1360988540, 3577302766, 1310130331, 3955244037, 1098006492, 3764445841, 1878592451, 1366309691, 834733241, 1756247085, 1477076581, 1541448397, 237938899, 463266713, 1285929466, 421891336, 245229674, 2247628358, 2978163106, 1874574671, 1026649882, 2751526106, 1355705401, 3245049908, 3382833204, 1030706533, 3289502839, 4230992213, 3733577714, 1175709875, 1427089806, 3253678652, 202135768, 1090837016, 1821331724, 411825771, 3410064564, 1359823070, 434349498, 1060357772, 3104627769, 756777566, 2906892554, 2203304863, 3951472222, 1643188592, 3254798665, 3135677288, 2166927846, 2144684151, 1409935604, 3689678999, 1490311626, 4138197875, 3600132491, 273597853, 2807049005, 762991194, 3222545074, 2327667731, 1037140465, 2641037943, 2221572183, 2287766304, 3911102564, 852703510, 3556209127, 3576024844, 4089960265, 3535437520, 4178873396, 2283853048, 2389294948, 1546851560, 3909946392, 2070081284, 2594357647, 3229865453, 627597232, 1432374192, 4165388271, 3511818121, 433088822, 712937651, 3262613905, 1524339426, 2077831276, 583303799, 2537824742, 3872147695, 290142933, 684984487, 3204485919, 3140925245, 2035669498, 1543198749, 2177104772, 4164146408, 2777901169, 874186028, 3622470580, 2205124636, 2818419230, 3509185440, 3237199767, 4150406156, 1335785196, 1498593145, 1803425682, 602447842, 3322299819, 2411479201, 2300824561, 2490032064, 2194297450, 1138950984, 1826373461, 1063591759, 2339800918, 3930660157, 1394458220, 661245181, 497318565, 638805148, 538199385, 2293594640, 1063248419, 3980150931, 2619814839, 3076055562, 2254658952, 1128990414, 2925107549, 3830135984, 156379681, 2488578613, 1422872512, 1131238984, 4149973779, 1089745732, 1211157238, 3235347974, 553862654, 1474778111, 2873209930, 1651816577, 2873733434, 2547660662, 1059801324, 2837830363, 183057647, 1296432652, 110057295, 1005185348, 1889388743, 797195327, 271513526, 2943188866, 2759953084, 3732834436, 680441799, 3179079584, 702802440, 1559984368, 3153158635, 3134808068, 3983454472, 2041674238, 2928056332, 1330416154, 3215929416, 3598156951, 3285558965, 2876719592, 1425615732, 3538456320, 1876315517, 2966241225, 1825043769, 2562662866, 328208576, 2801010995, 3919545179, 2844430947, 4148841141, 2981135466, 3941300992, 3694996336, 3247818512, 2030952683, 2537246170, 2242855141, 3392790633, 3968319912, 196778217, 3340231136, 2221457210, 120474872, 4139687796, 291012663, 3209017985, 2824013484, 2155396326, 599513999, 1874416715, 2309017893, 3769565490, 914140509, 745965067, 936856476, 1231449017, 3812023526, 3641240373, 1088905996, 2915884157, 697525263, 1605170865, 4180377525, 3115751094, 290408530, 900884911, 2019669555, 856643658, 801120976, 2047249490, 3539848968, 1049821410, 4192465710, 975136332, 3897701119, 362163334, 45071318, 3063851768, 1176293338, 3269989748, 1807816687, 2815962615, 2702749402, 362365826, 3255796833, 3298703660, 3668753632, 2478841621, 3893324051, 3343127357, 486312487, 763040499, 3764827354, 274563269, 3367156250, 1746826574, 4102013571, 1044949749, 1772579035, 3209424170, 1718905463, 4039791334, 2537768094, 3641852937, 3945528010, 2064520826, 2297935736, 2029810017, 3697203930, 2996492108, 682028678, 1223604047, 3918168562, 3408374382, 1716822504, 705482037, 2279331131, 1643935216, 2886742812, 1072292001, 3725730608, 1663897916, 2299429500, 3281874628, 884231075, 3858410944, 1218009066, 3304774196, 4262495392, 4212733252, 2476159526, 2921841224, 1052358941, 1604667223, 315235963, 895849361, 1387889414, 2121973471, 4174919473, 4131177992, 2669177278, 2334196787, 2885818962, 1926644377, 2518573000, 1021990751, 777726483, 1865098440, 2351636175, 2918719313, 1409247598, 695794790, 3700584096, 3842214756, 2676275366, 807800932, 2612063886, 3560513340, 311616609, 4092250129, 976840663, 181297416, 3294514607, 341294554, 1528761207, 4182135703, 585535065, 274178313, 4005992590, 3327977841, 1716789174, 683370798, 4169912022, 3097451666, 1878261222, 2695199504, 1884287017, 3738115926, 1502095289, 1739729926, 741825285, 4155211093, 865376942, 3662044539]

        mwc = MWC1616(seed, a=a, b=b)
        self.assertEqual([mwc.generate() for _ in range(len(expected_result))], expected_result)



    def test_crack(self):
        mwc = MWC1616([Bytes.random(4).int() for _ in range(2)])
        out = [mwc.generate() for _ in range(3)]

        other_mwc = MWC1616([0,0])
        other_mwc = other_mwc.crack(out)

        self.assertEqual(mwc.state, other_mwc.state)
